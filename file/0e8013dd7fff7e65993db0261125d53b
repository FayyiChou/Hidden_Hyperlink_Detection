<!DOCTYPE html>
<html>
 <head> 
  <meta http-equiv="content-type" content="text/html;charset=utf-8" /> 
  <title>简单PHP实现Pocket抓取知乎专栏文章_PHP_WEB-ITnose</title> 
  <meta name="keywords" content="简单PHP实现Pocket抓取知乎专栏文章" /> 
  <meta name="description" content="简单PHP实现Pocket抓取知乎专栏文章" /> 
  <link rel="stylesheet" type="text/css" href="/cssfile/detail.css" /> 
  <script type="text/javascript" src="/Scripts/jquery.js"></script> 
  <!--[if lte IE 8]><script>(function(){ var e="abbr,article,aside,audio,canvas,datalist,details,dialog,eventsource,figure,footer,header,hgroup,mark,menu,meter,nav,output,progress,section,time,video".split(","),i=e.length;while(i--){document.createElement(e[i])}})();</script><![endif]--> 
 </head> 
 <body class="body-slei-center"> 
  <div class="line"> 
   <div id="userbar" class="userbar"> 
    <ul class="main-list"> 
     <li></li> 
    </ul> 
   </div> 
  </div> 
  <header id="header" class="container"> 
   <div id="top-box-slei" class="top-box-slei line pt-20"> 
    <a class="logo" href="/" title="logo"></a> 
    <ul class="channel"></ul> 
    <form action="/s.do" method="get" class="search-form"> 
     <div class="box"> 
      <span class="top-box-slei-bg"></span> 
      <input class="hdi" id="itnosekw" maxlength="256" tabindex="1" size="46" name="kw" value="" /> 
      <span class="btn-wrap"><input type="submit" tabindex="2" value="搜索文章" class="btn-global" /></span> 
     </div> 
    </form> 
   </div> 
  </header> 
  <div id="body" class="container"> 
   <div id="menu" class="menu"> 
    <ul> 
     <li class="current ml-10"><a href="/"> 首页 </a></li> 
     <li><a href="/type/69.html">ASP</a></li> 
     <li><a href="/type/70.html"><font color="#FFFF00">PHP</font></a></li> 
     <li><a href="/type/71.html">JavaScript</a></li> 
     <li><a href="/type/76.html">IIS</a></li> 
     <li><a href="/type/77.html">Apache</a></li> 
     <li><a href="/type/78.html">html/css</a></li> 
     <li><a href="/type/79.html">ColdFusion</a></li> 
     <li><a href="/type/72.html">Ajax</a></li> 
     <li><a href="/type/73.html">VBScript</a></li> 
     <li><a href="/type/74.html">CGI</a></li> 
     <li><a href="/type/75.html">XML/XSL</a></li> 
     <li><a href="/type/81.html">跨浏览器开发</a></li> 
     <li><a href="/type/80.html">Ruby/Rails</a></li> 
     <li><a href="/type/82.html">程序员</a></li> 
     <li><a href="/type/83.html">HTML5</a></li> 
     <li><a href="/type/111.html">JQuery</a></li> 
     <li><a href="/type/122.html">seo</a></li> 
     <li><a href="/type/120.html">jboss</a></li> 
     <li><a href="/type/128.html">Json</a></li> 
     <li><a href="/type/144.html">angularJS</a></li> 
     <li><a href="/type/145.html">Markdown</a></li> 
     <li><a href="/type/160.html">nginx</a></li> 
     <li><a href="/type/148.html">ThinkPHP</a></li> 
     <li><a href="/type/149.html">Yii</a></li> 
     <li><a href="/type/167.html">PageAdmin</a></li> 
     <li><a href="/type/179.html">Extjs</a></li> 
     <li><a href="/type/181.html">WampServer</a></li> 
     <li><a href="/type/186.html">Kendo UI</a></li> 
     <li><a href="/type/256.html">CoffeeScript</a></li> 
     <li><a href="/type/263.html">Gulp</a></li> 
     <li><a href="/type/264.html">ECMAScript</a></li> 
     <li><a href="/type/267.html">Bootstrap</a></li> 
    </ul> 
   </div> 
   <div style="margin-top:10px;border: 1px solid #CCC;background-color: #FFF;width: 1088px;padding:5px 5px 0px 5px;height:100px"> 
    <script type="text/javascript">
    var cpro_id = "u1737258";
</script> 
    <script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script> 
   </div> 
   <div> 
    <div> 
     <nav> 
      <a href="/">ITnose首页</a> &gt; 
      <a href="/union/5.html">WEB</a> &gt; 
      <a href="/type/70.html">PHP</a> &gt; 
     </nav> 
    </div> 
    <section class="line qb-section"> 
     <article class="grid qb-content" id="qb-content"> 
      <div class="wgt-ask" style="background-color:#FFF;"> 
       <h1 class="title"> <span class="title"><a href="/detail/6660672.html">简单PHP实现Pocket抓取知乎专栏文章</a></span> </h1> 
       <div class="line f-aid mb-10"> 
        <span class="grid-r ask-time">2016-11-02 19:58</span> 
        <div class="bdsharebuttonbox">
         <a href="#" class="bds_more" data-cmd="more"></a>
         <a title="分享到QQ空间" href="#" class="bds_qzone" data-cmd="qzone"></a>
         <a title="分享到新浪微博" href="#" class="bds_tsina" data-cmd="tsina"></a>
         <a title="分享到腾讯微博" href="#" class="bds_tqq" data-cmd="tqq"></a>
         <a title="分享到人人网" href="#" class="bds_renren" data-cmd="renren"></a>
         <a title="分享到微信" href="#" class="bds_weixin" data-cmd="weixin"></a>
        </div> 
        <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script> 
       </div> 
       <div class="bd line mt-10 q-content"> 
        <div class="sougouContent"> 
         <div> 
          <div> 
           <h2> Pocket 抓取知乎专栏的问题 </h2> 
           <p> <a href="https://getpocket.com/" target="_blank">Pocket</a> 是我平时用的比较多的 稍后阅读 类网络服务，其收集抓取网上文章正文的效果比较好，去除页面广告等无关内容还算给力，支持标记和搜索，同步速度也还可以，免费会员限制也挺少，所以看到一些来不及马上阅读消化的文章我都会先加到 Pocket 队列里，有空时再去查看归档。 </p> 
           <p>只是由于目前抓取网页正文原理的限制，Pocket 对现在越来越多的 AJAX 动态网页基本上都支持的不太好，比较典型的就是知乎专栏文章了。知乎专栏之前曾经是支持 Pocket 直接抓取的，改为 AJAX 加载数据之后，发送文章到 Pocket 之后就是这种效果：</p> 
           <p> <img src="http://www.itnose.net/img/20161102/176544.png" alt="简单PHP实现Pocket抓取知乎专栏文章0" /> </p> 
           <p>Pocket 正常抓取的文章应该能显示摘要文字或者文章中的图片，知乎专栏文章则是空白的，而且点击文章条目也是直接跳转到知乎专栏链接，并没有显示 Pocket 抓取优化的效果。</p> 
           <h2> 问题分析 </h2> 
           <p>稍微看看知乎专栏网页代码可以发现，如果在浏览器中访问类似这样的专栏文章链接：</p> 
           <p> <a href="https://zhuanlan.zhihu.com/p/21542817" target="_blank">https://zhuanlan.zhihu.com/p/21542817</a> </p> 
           <p>实际会加载下面的文章内容数据 API 链接，知乎专栏页面加载完数据之后才会显示：</p> 
           <p> <a href="https://zhuanlan.zhihu.com/api/posts/21542817" target="_blank">https://zhuanlan.zhihu.com/api/posts/21542817</a> </p> 
           <p>这种动态加载方式显然 Pocket 是不支持的，不过也好办，我们自己用 PHP 或者 Node.js 等实现一个简单的程序读取专栏文章内容并输出，然后放到 VPS 或者其它虚拟主机上运行，后面访问我自己的网址并发送到 Pocket 应该就可以使 Pocket 正确抓取了。另外这种方式比较好的一面就是输出内容里没有任何其它知乎相关的网页代码，只有专栏文章内容，更易于 Pocket 抓取处理。</p> 
           <h2> PHP 程序 Pocket 抓取效果 </h2> 
           <p> 这个 PHP 程序实在没有什么技术含量，我就直接写一个简单的 PHP 文件接受传入专栏页面 ID 的 page 参数然后输出文章内容即可： </p> 
           <pre class="sycode" name="code">&lt;?php
if (!isset($_GET[&quot;page&quot;])) {
	echo &quot;need page id.&quot;;
	exit;
}

$PAGE_ID = $_GET[&quot;page&quot;];
$P_HEADERS = getallheaders();

if (array_key_exists(&quot;Referer&quot;, $P_HEADERS) || (isset($_GET[&quot;redirect&quot;]) &amp;&amp; $_GET[&quot;redirect&quot;] == '1')) {
	header(&quot;Location: https://zhuanlan.zhihu.com/p/&quot; . $PAGE_ID);
	exit;
}
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot;/&gt;
&lt;?php
$PAGE_DATA = file_get_contents(&quot;https://zhuanlan.zhihu.com/api/posts/&quot; . $PAGE_ID);
$PAGE_OBJ = json_decode($PAGE_DATA);
echo '&lt;title&gt;' . $PAGE_OBJ-&gt;{&quot;title&quot;} . '&lt;/title&gt;';
?&gt;
&lt;link rel=&quot;shortcut icon&quot; href=&quot;https://static.zhihu.com/static/favicon.ico&quot; type=&quot;image/x-icon&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;
&lt;?php
echo $PAGE_OBJ-&gt;{&quot;title&quot;};
?&gt;
&lt;/h1&gt;
&lt;div&gt;
&lt;?php
echo $PAGE_OBJ-&gt;{&quot;content&quot;};
?&gt;
&lt;div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre> 
           <p> 上面的程序只是简单做了下判断，如果请求头中包含 Referer 信息（例如从 Pocket 网站跳转等）或者请求地址中 redirect 参数值为 1 就会直接跳转到知乎专栏页面，默认则输出专栏文章内容。另外程序中使用了 getallheaders 函数得到 HTTP 请求头信息，默认只支持 Apache，如果你要在 nginx 等服务器上使用则稍微修改下即可。 </p> 
           <p>把上面的 PHP 程序放到虚拟主机上，访问类似下面的链接（单纯演示用，需要翻墙哦）：</p> 
           <p> <a href="http://devio.us/~nocwat/zhihu-grub.php?page=21542817" target="_blank">http://devio.us/~nocwat/zhihu-grub.php?page=21542817</a> </p> 
           <p>正确显示文章内容后，将上面的链接发送到 Pocket 稍等片刻就能在 Pocket 队列里看到抓取的专栏文章了。</p> 
           <div> 
            <h4>提示</h4> 
            <p>由于知乎专栏中的图片做了防盗链策略，直接访问上面的链接可能会出现文章中的图片不能正确显示的问题，不过没关系，Pocket 会自动为我们抓取保存文章中的图片的。</p> 
           </div> 
           <p>最后来看看我的 Pocket 队列里的显示效果：</p> 
           <p> <img src="http://www.itnose.net/img/20161102/176545.png" alt="简单PHP实现Pocket抓取知乎专栏文章1" /> </p> 
           <p> 而且点击文章条目进入也能看到 Pocket 优化过的文章内容，在 Pocket 中点击 <strong>查看原始文档</strong> 也能自动跳转到知乎的专栏文章页面，这样再也不用担心专栏作者删除文章之后就没办法查看咯。 </p> 
          </div> 
         </div> 
        </div> 
        <div class="contentDown2"> 
         <div id="gg" style="float:left;width:300px;margin:5px;"> 
          <script type="text/javascript">
var cpro_id="u2064564";
(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"300",rsi1:"250",pat:"17",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"1",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"14",rss2:"#000000",titSU:"0"}
</script> 
          <script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script> 
         </div> 
        </div> 
        <div style="text-align:center;margin-top:5px"> 
         <script type="text/javascript">
var cpro_id="u2057855";
(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"739",rsi1:"250",pat:"6",tn:"baiduCustNativeAD",rss1:"#FBFBFB",conBW:"1",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"13",rss2:"#000000",titSU:"0",ptbg:"90",piw:"0",pih:"0",ptp:"0"}
</script> 
         <script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script> 
        </div> 
        <div id="fenxiang">
         <span style="color:#aaaaaa" id="originUrl"></span>
        </div> 
       </div> 
      </div> 
      <div class="wgt-relate-search mt-5 mb-5"> 
       <h2>相关搜索：</h2> 
       <a href="/s/java%e5%9f%ba%e7%a1%80%e6%96%87%e7%ab%a0.html" target="_blank">java基础文章</a> 
       <a href="/s/webservice%20%e5%ae%9e%e7%8e%b0.html" target="_blank">webservice 实现</a> 
       <a href="/s/spring%20aop%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86.html" target="_blank">spring aop实现原理</a> 
       <a href="/s/spring%20%e7%ae%80%e5%8d%95%e4%be%8b%e5%ad%90.html" target="_blank">spring 简单例子</a> 
       <a href="/s/spring%e5%ae%9e%e7%8e%b0%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0.html" target="_blank">spring实现文件上传</a> 
      </div> 
      <div class="wgt-related mt-5 " id="wgt-related"> 
       <h2>相关文章</h2> 
       <div class="leftlist"> 
        <ul> 
         <li><span class="grid-r tm">2016-12-13 08:00</span> <a href="/detail/6686729.html"> 百万级别知乎用户数据抓取与分析之PHP开发 </a> </li> 
         <li><span class="grid-r tm">2014-08-13 21:51</span> <a href="/detail/6092472.html"> php文章内容抓取 </a> </li> 
         <li><span class="grid-r tm">2016-01-28 11:02</span> <a href="/detail/6446294.html"> php 爬虫：知乎用户数据爬取和分析 </a> </li> 
         <li><span class="grid-r tm">2016-01-24 18:45</span> <a href="/detail/6443983.html"> php爬虫：知乎用户数据爬取和分析 </a> </li> 
         <li><span class="grid-r tm">2016-01-21 00:49</span> <a href="/detail/6441955.html"> PHP爬虫：百万级别知乎用户数据爬取与分析 </a> </li> 
        </ul> 
       </div> 
       <div class="mt-10"> 
        <a href="/st/6660672.html"> 更多相关文章&gt;&gt; </a> 
       </div> 
      </div> 
      <div class="wgt-related mt-5 " id="wgt-related"> 
       <h2>最新文章</h2> 
       <div class="leftlist"> 
        <ul> 
         <li><span class="grid-r tm">2017-03-26 23:30</span> <a href="/detail/6736191.html"> 怎么将多个二维数组 根据相同的键值合并为一个新的二维数组 </a> </li> 
         <li><span class="grid-r tm">2017-03-26 23:30</span> <a href="/detail/6736189.html"> JS转PHP 一直转不好 希望帮忙看一下 </a> </li> 
         <li><span class="grid-r tm">2017-03-26 23:30</span> <a href="/detail/6736187.html"> php遍历文件并执行 </a> </li> 
         <li><span class="grid-r tm">2017-03-26 22:36</span> <a href="/detail/6736145.html"> PHP处理WEB请求的流程 </a> </li> 
         <li><span class="grid-r tm">2017-03-26 20:22</span> <a href="/detail/6736106.html"> 使用xdegbu+phpstorm+(chrome|postman) 调试php </a> </li> 
        </ul> 
       </div> 
       <div class="mt-10"> 
        <a href="/type/70.html"> 更多最新文章&gt;&gt; </a> 
       </div> 
      </div> 
     </article> 
     <aside class="grid qb-side" id="qb-side"> 
      <div class="cms-slide"> 
       <div class="remen"> 
        <p class="h2">热门搜索</p> 
        <ul> 
         <li><a href="/s/spring%20mvc%e7%ae%80%e5%8d%95%e4%be%8b%e5%ad%90.html" target="_blank">spring mvc简单例子</a></li> 
         <li><a href="/s/java%e5%ae%9e%e7%8e%b0webservice.html" target="_blank">java实现webservice</a></li> 
         <li><a href="/s/c++%e5%ae%9e%e7%8e%b0webservice.html" target="_blank">c++实现webservice</a></li> 
         <li><a href="/s/%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0webservice.html" target="_blank">如何实现webservice</a></li> 
         <li><a href="/s/php%20jsp.html" target="_blank">php jsp</a></li> 
         <li><a href="/s/php%20webservice.html" target="_blank">php webservice</a></li> 
         <li><a href="/s/php%20%e5%9b%be%e8%a1%a8.html" target="_blank">php 图表</a></li> 
         <li><a href="/s/php%20xml.html" target="_blank">php xml</a></li> 
         <li><a href="/s/delphi%20for%20php.html" target="_blank">delphi for php</a></li> 
         <li><a href="/s/delphi%20php.html" target="_blank">delphi php</a></li> 
         <li><a href="/s/php%20sqlserver.html" target="_blank">php sqlserver</a></li> 
         <li><a href="/s/spring%203.0%e5%b0%b1%e8%bf%99%e4%b9%88%e7%ae%80%e5%8d%95.html" target="_blank">spring 3.0就这么简单</a></li> 
         <li><a href="/s/%e7%ae%80%e5%8d%95%e6%95%b0%e6%8d%ae%e5%ba%93.html" target="_blank">简单数据库</a></li> 
         <li><a href="/s/c%e8%af%ad%e8%a8%80%e7%ae%80%e5%8d%95%e7%a8%8b%e5%ba%8f.html" target="_blank">c语言简单程序</a></li> 
         <li><a href="/s/%e7%ae%80%e5%8d%95%e7%9a%84c%e8%af%ad%e8%a8%80%e7%a8%8b%e5%ba%8f.html" target="_blank">简单的c语言程序</a></li> 
        </ul> 
       </div> 
      </div> 
      <div class="cms-slide"> 
       <script type="text/javascript">
var cpro_id="u2062662";
(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"300",rsi1:"280",pat:"17",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"1",adp:"1",ptt:"1",ptc:"%E7%8C%9C%E4%BD%A0%E6%84%9F%E5%85%B4%E8%B6%A3",ptFS:"14",ptFC:"#000000",ptBC:"#F2F2F2",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"12",rss2:"#000000",titSU:"0"}
</script> 
       <script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script> 
      </div> 
      <div class="cms-slide" id="tuijian"></div> 
      <div class="fixed"> 
       <div class="cms-slide"> 
        <script type="text/javascript">
    var cpro_id = "u2062674";
</script> 
        <script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script> 
       </div> 
       <div class="cms-slide"> 
        <script type="text/javascript">
var cpro_id="u1983378";
(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"300",rsi1:"250",pat:"6",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"1",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"13",rss2:"#333333",titSU:"0",ptbg:"90",piw:"0",pih:"0",ptp:"0"}
</script> 
        <script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script> 
       </div> 
      </div> 
     </aside> 
    </section> 
   </div> 
   <footer id="footer">
    <p>京ICP备14022385号-2</p>
    <p>&copy;2014 <a href="/">ITnose软件编程教程</a>&nbsp;|&nbsp;联系我们：Email：twobrushes@126.com &nbsp;&nbsp;QQ:35155868</p>
    <p style="display:none"><script language="javascript" type="text/javascript" src="http://js.users.51.la/16757612.js"></script><script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1258921346'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1258921346%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script></p>
   </footer> 
  </div> 
  <script>
$(document).ready(function(e) {			
	t = $('.fixed').offset().top;
	mh = $('article').height();
	mt = $('article').offset().top;
	fh = $('.fixed').height();
	$(window).scroll(function(e){
		s = $(document).scrollTop();	
		if(s > t-1){
			$('.fixed').css('position','fixed');
			if(s + fh > mh+mt){
				$('.fixed').css('top',mh+mt-s-fh+'px');	
			}else{
				$('.fixed').css('top',mh-s+'px');
				$('.fixed').offset({top:s});
			}				
		}else{
			$('.fixed').css('position','');
		}
	})
});
var tuijiandoc='<div class="cms-inner"><p class="h2 ml-5">推荐文章</p><ul class="ml-5" ><li ><a href="/detail/6686729.html"> 百万级别知乎用户数据抓取与分析之PHP开发</a></li><li ><a href="/detail/6446294.html"> php 爬虫：知乎用户数据爬取和分析</a></li><li ><a href="/detail/6443983.html"> php爬虫：知乎用户数据爬取和分析</a></li><li ><a href="/detail/6441955.html"> PHP爬虫：百万级别知乎用户数据爬取与分析</a></li><li ><a href="/detail/6492678.html"> PHP简单分页的实现</a></li><li ><a href="/detail/6208538.html"> php 抓取图片</a></li><li ><a href="/detail/525096.html"> PHP采集 抓取</a></li><li ><a href="/detail/6689248.html"> PHP实例CURL实现简单采集</a></li></ul></div>';
document.getElementById("tuijian").innerHTML=tuijiandoc;
//document.getElementById("originUrl").innerHTML="From : http://www.tuicool.com/articles/6ZFRzm7";
var contentDown=$(tuijiandoc);
contentDown.find("p").html('<span class="h2">相关文章</span><span style="font-size:13px;float:right;padding-right:25px"><a href="/st/6660672.html">&lt;&lt;更多&gt;&gt;</a></span>').removeAttr("class").attr("style","border-bottom: 1px dashed #aaa;height:26px;margin-right:10px;margin-bottom:2px");
contentDown.find("ul").removeAttr("class");
contentDown.attr("class","contentDown");
$('.contentDown2').append(contentDown);
</script>  
 </body>
</html>