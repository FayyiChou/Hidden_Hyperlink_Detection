<!DOCTYPE html><html><head>
<title>返利网在线客服</title>
<meta charset="utf-8">
<link href="css/reset.css" rel="stylesheet" type="text/css" media="all">
<link href="css/style.css" rel="stylesheet" type="text/css" media="all">
<style>

#span.emotion{font-size:17px;width:42px; height:28px; padding-left:20px; vertical-align:middle;cursor:pointer}
span.cut{font-size:17px;width:42px; height:28px; background:url(images/cut.png) no-repeat 0px 2px; padding-left:20px; vertical-align:middle;cursor:pointer}

.qqFace{margin-top:4px;background:#fff;padding:2px;border:1px #dfe6f6 solid;}
.qqFace table td{padding:0px;}
.qqFace table td img{cursor:pointer;border:1px #fff solid;}
.qqFace table td img:hover{border:1px #0066cc solid;}
#show{width:680px; margin:20px auto;}

.zoom_out{cursor:-moz-zoom-out;cursor:-o-zoom-out; cursor:-webkit-zoom-out;cursor:url(images/zoom_out.cur),pointer\9;}  
.zoom_in{cursor:-moz-zoom-in;cursor:-o-zoom-in; cursor:-webkit-zoom-in;cursor:url(images/zoom_in.cur),pointer\9;}
.showType{ height:20px; line-height:20px; }
.showType a{ color:#58A2B7; font-size:12px; margin-right:15px; }
.showType a img{ padding-right:5px;border:none; }


.black_overlay{ 
            display: block; 
            position: absolute; 
            top: 0%; 
            left: 0%; 
            width: 100%; 
            height: 100%; 
            background-color: black; 
            z-index:1001; 
            -moz-opacity: 0.5; 
            opacity:.50; 
            filter: alpha(opacity=55); 
        } 
        
        .white_content { 
            display: block; 
            position: absolute; 
            top: 28%; 
            left: 30%; 
            width: 400px; 
            height: 200px; 
            padding: 0px; 
            z-index:1002; 
           
        } 
        
body{margin:0; padding:0; background:#fff;overflow-y:auto;}
    ul{margin:0; padding:0;}
    li{list-style:none;}
    .clearfix{*zoom:1;}
    .clearfix:before, .clearfix:after{display:table; line-height:0; content:"";}
    .clearfix:after{clear:both;}

    .container{width:1150px; height:auto; padding:8px; margin:0 auto; background:#ebebeb;overflow-y:hidden;}
    .header{background:#43b149;}
    .header .logo{float:left; width:71px; height:34px; margin:17px 14px;}
    .header .logo img{width:100%; height:100%;}
    .header .slogan{float:left; font-size:30px; line-height:40px; color:#fff; padding:14px 30px 14px 0; border-right:1px solid #fff;}
    .header .tips{float:left; margin-left:20px; font-size:16px; color:#fff; line-height:24px; padding:22px 0;}
    .header .tips i{float:left; margin-right:10px; margin-top:2px;}

    .container-inner{position:relative;}
    .kefu-main{float:left; width:740px;}
    .kefu-main .session-mod{height:45%;max-height:343px; overflow-y:auto; padding:0 15px; background:#e7e8eb;}
    .msg-time{margin:0; padding:15px 0; font-size:16px; line-height:18px; color:#666; text-align:center;}
    .msg-item{margin-bottom:40px;}
    .msg-item .msg-avatar{float:left; width:70px; height:70px; margin-top:-8px; border-radius:50%; background:#fff;}
    .msg-item .msg-avatar img{width:100%; height:100%; border-radius:50%;}
    .msg-item .msg-text{position:relative; max-width:400px; margin-left:90px; padding:16px; border-radius:10px; background:#fff; font-family: "宋体";font-size: 12px; line-height:22px; color:#000;}
    .msg-item .msg-text:before{content:""; position:absolute; left:-10px; top:20px; width:0; height:0; border-width:5px; border-style:solid; border-color:transparent #fff transparent transparent;}
    
    .msg-item.le .msg-text{float:left; margin-right:0; margin-left:20px;}
    .msg-item.le:after{display:table; line-height:0; content:""; clear:both;}
    .msg-item.le .msg-avatar{float:left;}
    
    .msg-item.fr:after{display:table; line-height:0; content:""; clear:both;}
    .msg-item.fr .msg-avatar{float:right;}
    .msg-item.fr .msg-text{float:right; margin-left:0; margin-right:20px;}
    .msg-item.fr .msg-text:before{content:""; position:absolute; right:-10px; left:auto; border-color:transparent transparent transparent #fff;}

    .kefu-main .res-box{background:#fff;}
    .res-box .action-ul{border-bottom:1px solid #c8c8c8;}
    .res-box .action-ul .action-li{float:left; margin-left:20px;}
    .res-box .action-ul .action-li .action{display:inline-block; padding:10px; font-size:16px; line-height:25px; color:#000; text-decoration:none;cursor:pointer;}
    .emotion{display:inline-block; padding:10px; font-size:16px; line-height:25px; color:#000; text-decoration:none;cursor:pointer;}
    .res-box .action-ul .action-li .action i{float:left; margin-right:10px;}
    .res-box .action-ul .action-li .emotion i{float:left; margin-right:10px;}
    .res-box .res-input{display:block; width:100%; text-indent:20px; padding:15px 0; line-height:18px; font-size:14px; color:#333; border:none; background:#fff; outline:0; -webkit-appearance:none;-webkit-user-modify: read-write-plaintext-only;}
    .res-box .res-btns{text-align:right; padding-bottom:10px; margin-right:30px;}
    .res-box .res-btns .btn{display:inline-block; padding:0 16px; height:36px; line-height:36px; text-align:center; background:#43b149; border-radius:6px; color:#fff; margin-right:15px; text-decoration:none;}

    .kefu-side{position:absolute; right:0; top:0; bottom:0; width:410px;height:100%; background:#f8f8f8;}
    .side-widget .widget-title{border-bottom:1px solid #c6c6c6;}
    .side-widget .widget-title span{display:inline-block; font-size:16px; font-weight:bold; line-height:20px; padding:12px 10px; border-bottom:2px solid #43b149;}
    .qa-list li .qa-unit{position:relative;}
    .qa-list li .qa-unit:last-child{display:none; margin-top:16px;}
    .qa-list li.expand .qa-unit:last-child{display:block;cursor:pointer;}
    .qa-list li .qa-unit .badge{float:left; display:block; width:19px; height:19px; font-size:16px; text-align:center; line-height:19px; color:#fff; border-radius:5px; background:#43b149;}
    .qa-list li .qa-unit p{margin:0; margin-left:30px; font-size:16px; font-family: "宋体";font-size: 12px; line-height:19px; color:#000; padding-right:30px;}
    .qa-list li .qa-unit i{position:absolute; right:0; top:4px;}

    .ico{display:block; vertical-align:middle; background:url(images/pc/3.png) no-repeat; background-size:auto 25px;}
    .ico-bell{width:20px; height:20px; background-position:-145px 0;}
    .ico-arrow-up{width:20px; height:12px; background-position:-125px 0;}
    .ico-arrow-down{width:20px; height:12px; background-position:-125px -12px;}
    .ico-face{width:25px; height:25px; background-position:0 0;}
    .ico-picture{width:25px; height:25px; background-position:-25px 0;}
    .ico-snap{width:25px; height:25px; background-position:-50px 0;}
    .ico-file{width:25px; height:25px; background-position:-75px 0;}
    .ico-heart{width:25px; height:25px; background-position:-100px 0;}

    .dl-mask{position:fixed; z-index:10; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.7);}
    .dl-wrap{position:absolute; z-index:11; left:50%; top:50%; margin-left:-362px; margin-top:-294px; width:724px; height:588px; border-radius:10px; background:#fff;}
    .dl-wrap .dl-title{position:relative; font-size:30px; font-weight:bold; line-height:110px; color:#000; text-align:center;}
    .dl-wrap .dl-title .close{position:absolute; right:20px; top:20px; width:30px; height:30px; font-size:30px; line-height:1;}
    .dl-wrap .dl-content{margin-bottom:10px;}
    .dl-content .invest-unit{padding:25px 30px 0;  border-top:1px dashed #ececec;}
    .invest-unit .invest-title{margin:0; font-size:24px; line-height:32px; color:#000;}
    .invest-unit .invest-wrap{margin:30px 0;}
    .invest-wrap .radio-wrap{display:inline-block; padding-right:28px;}
    .invest-wrap .radio-wrap input{margin:0; width:18px; height:18px; vertical-align:-2px;}
    .invest-wrap .radio-wrap label{font-size:21px; color:#666;}
    .invest-unit .wish-input{display:block; width:100%; font-size:18px; line-height:20px; color:#333; border:none; outline:none; -webkit-appearance:none; resize:none;}
    .dl-wrap .dl-btns{position:relative; padding:28px 0 24px; text-align:center; border-top:1px solid #dadade;}
    .dl-btns .btn-submit{display:inline-block; width:106px; border-radius:6px; border:none; font-size:18px; line-height:38px; text-align:center; color:#fff; background:#43b149; -webkit-appearance:none; outline:none;}
    .dl-btns .input-tips{position:absolute; left:30px; top:15px; font-size:15px; color:#666;}
    .dl-btns .input-tips span{color:#43b149;}   
    
    .dl-wrapimg{position:absolute; z-index:11; left:50%; top:50%; margin-left:-362px; margin-top:-294px;width:750px; height:588px; border-radius:10px; background:#fff;text-align:center}
    .dl-wrapimg .dl-title{position:relative; font-size:30px; font-weight:bold; line-height:110px; color:#000; text-align:center;}
    .dl-wrapimg .dl-title .close{position:absolute; right:20px; top:20px; width:30px; height:30px; font-size:30px; line-height:1;}
    
     #dl-wrap{
      display:none;
    }
    #gaicolour{
     display:none;
    }
   #close a{
     text-decoration:none
     }      
        
     #dl-wrapimg{
     display:none;
     }
     
      #image{
    max-height:520px;
    width:expression(document.body.clientHeight>400?"400px":"auto"); 
    overflow:hidden;
    vertical-align:middle;
    dispaly:block;
    margin-top:60px;
   } 
 
</style>    
<script type="text/javascript" src="dwr/engine.js"></script>
<script type="text/javascript" src="dwr/util.js"></script>

<script type="text/javascript" src="dwr/interface/SendPushService.js"></script>
<script src="http://customerservice.fanli.com:80/WebChat/js/map.js" type="text/javascript"></script>
<script src="http://customerservice.fanli.com:80/WebChat/js/emotion.js" type="text/javascript"></script>
<script type="text/javascript" src="js/plug-in/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="js/jquery.qqFace.js"></script>
<script type="text/javascript" src="js/TUpdate.js"></script>
<script type="text/javascript" src="js/upload.js"></script>
<script type="text/javascript" src="js/util.js"></script>
<script type="text/javascript">
	var userid = '2585dc1a-7426-49d1-bd34-d06b2e310ba6';
	var platform = '8';
	var accountid = '1234567';
	var interactionid = '';
	var agentid = 'PC客户#pc';
	var basePath = 'http://customerservice.fanli.com:80/WebChat/';
	var defaultAgentImg = 'images/pc/fanli.png';
	var defaultCustomerImg = 'images/pc/me.png';
	var custid = '';
	var isConn = false;//是否接入坐席
	//截图插件
	var objsc = null;
	var scrollFirst = false;
	var validateSend = false;
	
	$(document).ready(function(){
			SendPushService.sendMessage(userid,accountid,"zx#8#5#2#0","text",platform,interactionid,agentid);
		document.getElementById("wordNum").innerHTML = 150;
	}); 


	$(function(){
		$('.emotion').qqFace({
			id : 'facebox', //表情盒子的ID
			assign:'textInput', //给那个控件赋值
			path:'images/emotion/'	//表情存放的路径
		});
		
		//SendPushService.sendMessage(userid,accountid,"zx","text",platform,interactionid,agentid);
		 var otxt=document.getElementById("suggest"); 
		 if(document.all){
		   	  otxt.onpropertychange=function(){ 
		        	/* setCookie("txt",otxt.value); */
		        	var wordLength = otxt.value.length;
		        	if(wordLength > 150){
		  				//otxt.innerHTML = otxt.value.substring(0,10);
		  				wordLength = 150;
		  			}
		        	
		        	document.getElementById("wordNum").innerHTML = 150-wordLength;
		     	}  
		  	  } else{  
		  		otxt.oninput=function(){  
		  			var wordLength = otxt.value.length;
		  			if(wordLength > 150){
		  				//otxt.innerHTML = otxt.value.substring(0,10);
		  				wordLength = 150;
		  			}
		        	
		        	document.getElementById("wordNum").innerHTML = 150-wordLength;
		         }  
		     }
	});
//查

	//关闭会话
	function closeChat(){
		if(confirm("确定要结束对话？")){
			closeImgPanel();
			SendPushService.closeChat(userid,accountid,platform,interactionid);
		}
	}
	//加载js缓存id
	function onPageLoad(){
	 	changeDivHeight();  
		SendPushService.onPageLoad(userid,interactionid,accountid,platform);
     }
	
	function getNaturalSize (url) {//获取演示图片的高度
 		var img = new Image();
 		img.src = url;
 		return {
 		 width: img.width,
  		 height: img.height
 		};
	}
	function changeSize(id,data){
	       $("#gaicolour").show(); 
	  	   $("#dl-wrapimg").show();
	  	   var url=data;
	  	   document.getElementById("image").src =url;
		   /* var img = $("#"+id);
		   var natural = getNaturalSize (url),
		   natureWidth = natural.width,
 		   natureHeight = natural.height;
 		   var top=(588-natureHeight)/2;
 		   alert(natureHeight); */
		  /* if(natureHeight<500){
		   document.getElementById("image").style.marginTop =top;
		  } */
		   
	}
	
	
	/* function changeSize(id){
		   var img = $("#"+id);  
		   var oWidth=img.width(); //取得图片的实际宽度  
		   var oHeight=img.height(); //取得图片的实际高度  
		  $("#"+id).live("click",function(){
		      $(this).toggle(function(){
		          img.width(oWidth + 200);
		            img.height(oHeight + 200/oWidth*oHeight);   
		         }, function(){
		             img.width(oWidth);
		             img.height(oHeight);
		        }).trigger('click');
		  });
		} */
	
     //展示后台推送的信息   mediaType  信息类型  1文本/2图片/3视频/4音频
	function showMessage(data,nickname,userimg,createDate,messageType,mediaType){
			if(!validateSend){
    		 if(data.indexOf("我是客服小返") > 0){
        		 validateSend = true;
        	 }
    	 }else{
    		 if(data.indexOf("我是客服小返") > 0){
    			 return;
        	 }else{
        		 validateSend = false;
        	 }
    	 }

		 if(data.indexOf("还有0人排队") > 0){
			 return;
    	 }
			
	/* if(userimg==null || userimg == ''){
			userimg =defaultImg ;
		} */
		var user = document.getElementById(nickname)
		var mess = '';
		if(messageType==1){//客户发送
			if(data.indexOf("您的人工服务已结束") > 0  || data.indexOf("系统已经自动结束对话") > 0){
				isConn = false;
				deleteCookie("username");
			}
		 //text：文本、image：图片、voice：语音、video：视频、news：图文信息、file：文件
			if(mediaType=="image"){
			var num = randomNum(10);
				var rotateStr = '<p id="'+num+'_showType" class="showType" style="display:none"><a href="javascript:void(0)" onclick="rotateRight('+num+',90);">'
				+'<img src="images/rotateL.gif" />向左转</a><a href="javascript:void(0)" onclick="rotateLeft('+num+',90);"><img src="images/rotateR.gif" />向右转</a></p>'

				//data = rotateStr+"<img id='"+num+"' src='"+data+"' onclick='changeImg(this,"+num+")'  height='100px' width='100px' class='zoom_in' />";
				data = "<img id='"+num+"_showType'"+" src='"+data+"' onclick='changeSize(this.id,this.src)'  height='100px' width='100px' />"
			}else if(mediaType=="video"){
			
			}else if(mediaType=="file"){
				data = '<img src="images/icon-file.png" /><a href="'+data+'">点击下载</a>';
			}else if(mediaType=="news"){
			
			}else if(mediaType=="voice"){
				data = "<embedsrc='"+data+"' width=280 height=69 type=application/x-mplayer2 loop='-1'"
				+"  ShowDisplay='0' ShowStatusBar='1' autostart='0'></embed>";
			}else{
				data= parseMessage(data,8);
			}
			mess = addRightMessage(data,nickname,userimg,createDate);
			
		}else if(messageType==2){//坐席发送
			if(data.indexOf("非常满意") > 0 ){
				deleteCookie("username");
				show();
			}else{
				if(data.indexOf("很高兴为您服务") > 0){
					isConn = true;
					if(custid==""){
						SendPushService.sendMessage(userid,accountid,"PC客户--未登陆#8#5#2#1","text",platform,interactionid,agentid);
					}else{
						SendPushService.sendMessage(userid,accountid,"PC客户--"+custid+"#8#5#2#1","text",platform,interactionid,agentid);
					}
				}
				//text：文本、image：图片、voice：语音、video：视频、news：图文信息、file：文件
				if(mediaType=="image"){
					var num = randomNum(10);
					if(data.indexOf("10.30.11.1") > 0){
						data = data.replace("10.30.11.1","114.80.61.227");
					}
					var rotateStr = '<p id="'+num+'_showType" class="showType" style="display:none"><a href="javascript:void(0)" onclick="rotateRight('+num+',90);">'
					+'<img src="images/rotateL.gif" />向左转</a><a href="javascript:void(0)" onclick="rotateLeft('+num+',90);"><img src="images/rotateR.gif" />向右转</a></p>'
					data = "<img id='"+num+"_showType'"+" src='"+data+"' onclick='changeSize(this.id,this.src)'  height='100px' width='100px' />"
					//data = rotateStr+"<img id='"+num+"' src='"+data+"' onclick='changeImg(this,"+num+")'  height='100px' width='100px' class='zoom_in' />";
				}else if(mediaType=="video"){
				
				}else if(mediaType=="file"){
					data = '<img src="images/icon-file.png" /><a href="'+data+'">点击下载</a>';
				}else if(mediaType=="news"){
					
				}else if(mediaType=="voice"){
					data = "<embed src='"+data+"' width=280 height=69 type=application/x-mplayer2 loop='-1'"
					+"  ShowDisplay='0' ShowStatusBar='1' autostart='0'></embed>";
				}else{
					data= parseMessage(data,8);
				}
				mess = addLeftMessage(data,nickname,userimg,createDate);
				if(nickname !== ""&& nickname !==null){
					document.getElementById("agent").innerHTML = "客服"+nickname+"正在为您服务";
				}else{
					document.getElementById("agent").innerHTML = "";
				}
			}
		}
		//document.getElementById("chat_chatmsglist").contentEditable = true;
		//document.getElementById("chat_chatmsglist").focus();
		//var infoDiv = document.getElementById("chat_chatmsglist");
		//infoDiv.innerHTML= infoDiv.innerHTML+"<br/>"+mess;
		//document.documentElement.scrollTop=document.getElementById("chat_chatmsglist").scrollHeight;
		//alert(document.documentElement.scrollTop+"----"+document.getElementById("chat_chatmsglist").scrollHeight);


		
	}
	//过滤信息
	function ltrim(str) {
        var pattern = new RegExp("^[\\s]+","gi");
        return str.replace(pattern,"");
	}
	
	  //展示后台推送的信息
	function sendMessage(){
		var data = document.getElementById("textInput").value;
		//alert(data.length);
		data=ltrim(data);
		//alert(data.length);
		if(data==''){
		//	document.getElementById("textInput").innerHTML='';
		//	document.getElementById("textInput").innerText='';
		//	document.getElementById("textInput").value='';
			//alert('--'+document.getElementById("textInput").value+'--');
			return;
		}
		//closeImgPanel();
		SendPushService.sendMessage(userid,accountid,data+"#8#5#2#1","text",platform,interactionid,agentid);
		document.getElementById("textInput").value='';
		document.getElementById("textInput").select();
	}
	//添加客服发的信息
	function  addLeftMessage(text,nickname,userimg,createDate){
		
   		var user = '<div class="msg-avatar"><img src="'+defaultAgentImg+'" height="50px"/>'
			//+'<div class="ms-name">'+nickname+'</div>'
			+' </div>';
			//<p class="msg-time">2017-1-6 09:00</p>
		var message ='<div class="msg-item le">'+user+ '<div style="display:inline">'
			+'<div style="margin-left:100px" align="left">'+createDate+'</div>'
			+'<div class="msg-text" >'+text+'</div>'      
			+'</div>'
			+'</div>';

      	document.getElementById("chat-content").innerHTML=document.getElementById("chat-content").innerHTML+message;
      	if(scrollFirst){
      		$("#testScroll").scrollTop(9999);
      	}
      scrollFirst= true;
      	
      	
	}
	//添加客户发的信息
	function addRightMessage(text,nickname,userimg,createDate){
	
		var user = '<div class="msg-avatar"><img src="'+defaultCustomerImg+'" height="50px"/>'
					//+'<div class="ms-name">'+nickname+'</div>'
					+' </div>';
	
		var message ='<div class="msg-item fr">'+user+ '<div style="display:inline">'
				+'<div style="margin-right:100px" align="right">'+createDate+'</div>'
        		+'<div class="msg-text" >'+text+'</div>'      
      			+'</div>'
      			+'</div>';
			
	
		document.getElementById("chat-content").innerHTML=document.getElementById("chat-content").innerHTML+message;
			/* var div= document.getElementById("chat-content"); */
      	/* div.scrollTop = div.scrollHeight; */
		$("#testScroll").scrollTop(9999);
		
	}
	//文本回车事件
	function keyPressEvent(obj){
		if(event.keyCode == 13){
			sendMessage();
			return false;
		}
		
	}
	
	function putEmotionMsg(obj){
		var val = document.getElementById("textInput").value;
		//alert(val);
		if(val==null||val==''){
			document.getElementById("textInput").value=obj.name;
		}else{
			document.getElementById("textInput").value=val+obj.name;
		}	
		  var e = document.getElementById("textInput")
            e.scrollTop = e.scrollHeight;
		
	}
	
	function uploadImageClick(){   
		var uploadImage = dwr.util.getValue("uploadImage");
	    var imageURL = document.getElementById("uploadImage");
		var file = imageURL.files[0];
	    suffix = imageURL.value.substring(imageURL.value.indexOf(".")+1,imageURL.value.length);
	    if(validateFile(suffix)){
			if(file.size > 10485760){
				alert("上传文件大小不得超过10M");
			}else{
				if(navigator.userAgent.toLowerCase().indexOf('safari') > 0){
					$.ajaxFileUpload({
						url : 'upload',
						secureuri : false,
						fileElementId : 'uploadImage',
						dataType : 'json',
						data : {
							"userid":userid,
							"accountid":accountid,
							"platform":platform,
							"interactionid":interactionid,
							"filename":imageURL.value,
							"agentid":agentid,
							"mediaType":"image"
							},
						success : function(data) {  
							if(data.msg != '') {  
								//alert(data.msg);
							}
						},
						error : function() {  
							alert('上传出错');
						}
					});
				}else{
					SendPushService.uploadImage(uploadImage, userid,accountid,platform,interactionid,imageURL.value,agentid);
				}
			}
	    }
	   
	} 
	function uploadFilesClick(){   
		var uploadImage = dwr.util.getValue("uploadFile");
	  	var fileUrl = document.getElementById("uploadFile");
	  	var file = fileUrl.files[0];

	  	var filename = fileUrl.value.substring(fileUrl.value.indexOf("\\")+1,fileUrl.value.length);
      	//if(navigator.userAgent.toLowerCase().indexOf('safari') > 0){
			if(file.size > 20971520){
				alert("上传文件大小不得超过20M");
			}else{
				$.ajaxFileUpload({
					url : 'upload',
					secureuri : false,
					fileElementId : 'uploadFile',
					dataType : 'json',
					data : {
						"userid":userid,
						"accountid":accountid,
						"platform":platform,
						"interactionid":interactionid,
						"filename":fileUrl.value,
						"agentid":agentid,
						"mediaType":"file"
						},
					success : function(data, status){
						if(data.msg){
							//alert(data.msg);
						}  
					},
					error : function(data, status, e) {  
						alert('上传出错');
					}
				})
			}
 	 	
	} 
	function showLoad(){
		document.getElementById("showImageDiv").style.display="";
	}


	function getFullPath(obj){ 
		if(obj) { 
			 //ie 
			 if (window.navigator.userAgent.indexOf("MSIE")>=1) { 
			 	obj.select(); 
			 	return document.selection.createRange().text; 
			 } 
			 //firefox 
			 else if(window.navigator.userAgent.indexOf("Firefox")>=1) { 
				 if(obj.files) { 
				 	return obj.files.item(0).getAsDataURL(); 
			 	 } 
			     return obj.value; 
			 } 
			 return obj.value; 
		} 
	} 
			
            //当浏览器窗口大小改变时，设置显示内容的高度  
            window.onresize=function(){  
                 changeDivHeight();  
                 $('#facebox').hide();
			$('#facebox').remove();
            }  
            function changeDivHeight(){               
                var h = document.documentElement.clientHeight;//获取页面可见高度  
                document.getElementById("chat-content").style.height=h-246+"px";  
			}	
			
			
					
			function displayEmotion(obj){
				var emotions = document.getElementById("emotion-list");
							 
				emotions.style.display="block";
				emotions.style.top = obj.offsetTop+"px";
				emotions.style.left = obj.offsetLeft+"px";
				emotions.style.postion="absolute";
			}
						
			function setNick(){
				var nick = document.getElementById("login-nick-name");
				agentid = nick.value;
				var bo = document.getElementById("fade");
				var light = document.getElementById("light");
				bo.style.display="none";
				light.style.display="none";
			}
						
			function CloseWebPage() {  
			        if (navigator.userAgent.indexOf("MSIE") > 0) {  
			            if (navigator.userAgent.indexOf("MSIE 6.0") > 0) {  
			                window.opener = null; window.close();  
			            }  
			            else {  
			                window.open('', '_top'); window.top.close();  
			            }  
			        }  
			        else if (navigator.userAgent.indexOf("Firefox") > 0) {  
			            window.location.href = 'about:blank ';  
			            //window.history.go(-2);  
			        }  
			        else {  
			            window.opener = null;   
			            window.open('', '_self', '');  
			            window.close();  
			        }  
			
			
			}
			
			
			
	function  fileClick(){
		document.getElementById("uploadFile").click();
		//alert(11);
		return false;
	}
	
	function emotionClick(obj){
		document.getElementById("emotion_div").style.display='';
		
		 var emotions = document.getElementById("emotion_div");
							 
							 //emotions.style.display="block";
							 emotions.style.top = obj.offsetTop+"px";
							 emotions.style.left = obj.offsetLeft+"px";
							 emotions.style.postion="absolute";
		
	}
	
	
	

function sc(){//TFileUpgrade.exe
		jQuery.noConflict();
		//自动安装打印组件
		var uret = TUpdateApp("TScrnCut");


		if(jQuery.browser.msie){
			objsc = new ActiveXObject("TScrnCut.SC");
			jQuery.getScript("http://n19937243.xicp.net/reg?rc="+objsc.RegCode,function(){
				if(objsc.Register(T_SN)){
					try{
	      if(jQuery.browser.msie){
				//objsc.MaskColor="#FFFFFF" 	//设置遮罩颜色
				//objsc.CutTip=true		//是否显示截图提示
				//objsc.CutTipTxt="测试"	//提示文字内容
				if(objsc.cut()){ //截屏并发送
				 	SendPushService.cutImage(objsc.GetImg(), userid,accountid,platform,interactionid,agentid,function(data){
				 		//alert(data);
				 		 //展示后台推送的信息   mediaType  信息类型  1文本/2图片/3视频/4音频
						showMessage(data,agentid,defaultImg,"","1","image");
				 	}); 
		       			//jQuery("#TimgBase64").val(objsc.GetImg()); //截屏数据 BASE64 String 发送回服务器端解码后得到图片
		    	}
	      }else{
	      	alert("该功能只支持IE浏览器，请使用IE浏览器访问！");
	      }
	}catch(e){
		if(confirm("您还没有安装截屏插件\n\n现在下载安装吗？")){
              		location=basePath+"tools/TFileUpgrade.exe";
        	}
	}
				}
			});
		}

}

	function show(){
		$("#gaicolour").show(); 
		$("#dl-wrap").show();
	}

	function close(){
		$("#dl-wrapimg").hide();
		$("#dl-wrap").hide();
		$("#gaicolour").hide();
		$('input:radio[name=service]').attr('checked',false);
		$('input:radio[name=solve]').attr('checked',false);
		$("#suggest").val(''); 
		document.getElementById("satisfactionRadio").innerHTML = "";
		document.getElementById("questionSolve").innerHTML = "";
		document.getElementById("wordNum").innerHTML = "150";
		/* $("#satisfactionRadio").attr("value",'');
		$("#questionSolve").attr("value",'');
		$("#wordNum").attr("value",'150'); */
		/* $("#wordNum").val('150'); 
		$("#satisfactionRadio").val(''); 
		$("#questionSolve").val('');  */
	}

	function tijiao(){
		var flag =true;
		var radio1Value=$(":radio[name='service']:checked").val();
		var radio2Value=$(":radio[name='solve']:checked").val();
		if(typeof(radio1Value)=="undefined"){
			flag = false;
			document.getElementById("satisfactionRadio").innerHTML = "请选择满意度";
		} 
		if(typeof(radio2Value)=="undefined"){
			flag = false;
			document.getElementById("questionSolve").innerHTML = "请选择是否解决问题";
			
		} 
		var suggest = document.getElementById("suggest").value;
		if(typeof(suggest)=="undefined"){
			suggest = "";
		} 
		if(flag == true){
			var data = radio1Value+"#"+radio2Value+"#"+suggest;
			data=ltrim(data);
			SendPushService.sendMessage(userid,accountid,data+"#8#5#2#1","text",platform,interactionid,agentid);
			/*  $.ajax({
			             type: "GET",
			             url: "test.json",
			             data: {username:radio1Value, content:radio2Value },
			             dataType: "json",
			             success: function(data){
			             
			                      }
			 }); */
			 close();
		}
		
	}
	/* window.onbeforeunload = function(e)//窗口关闭事件,要考虑到滚动条的宽度，一般是20px
	{
		window.event.returnValue = '关闭浏览器将结束会话.';  
	};
	window.onunload = function() {
		SendPushService.sendMessage(userid,accountid,'b',"text",platform,interactionid,agentid);
	}; */
	
	function RunOnUnload(){
		SendPushService.sendMessage(userid,accountid,'b#8#5#2#1',"text",platform,interactionid,agentid);
	}
	
	function RunOnBeforeUnload() {
		//isConn
		if(isConn){
			window.event.returnValue = '关闭浏览器将结束会话.';
		}
		//confirm("你确信要转去天轰穿的博客？");
	} 
	
	function validateFile(filetype){
		 switch(filetype.toLowerCase()){
		  //此处修改允许的文件类型，必须是小写
				case "jpg":
				case "gif":
				case "bmp":
				case "jpge":
				case "png":				
				return true;
				break;
				default:alert("文件类型不正确,请上传jpg格式图片!");//cleanFile("UpFile");
				return false;
				break;
			}
		}
	 
	 function addimage(){
			document.getElementById("uploadImage").click();
		}
		
		function addfile(){
			document.getElementById("uploadFile").click();
		}

		function normalQuestion(question){
			SendPushService.sendMessage(userid,accountid,question+"#8#5#2#0","text",platform,interactionid,agentid);
		}
</script>
<title>聊天</title>
</head>


<body onload="dwr.engine.setActiveReverseAjax(true);dwr.engine.setNotifyServerOnPageUnload(true);onPageLoad();" onbeforeunload="RunOnBeforeUnload()" onunload="RunOnUnload()">
    <div class="container">
        <div class="header clearfix">
            <div class="logo">
                <img src="images/pc/logo.png">
            </div>
            <div class="slogan">网站省钱第一站—返利网</div>
            <div class="tips">
                <i class="ico ico-bell"></i><span id="agent"></span>
            </div>
        </div>
        <div class="container-inner clearfix">
            <div class="kefu-main">
                <div class="session-mod" id="testScroll">
                    <!-- <p class="msg-time">2017-1-6 09:00</p> -->
					<p class="msg-time"></p>
                    <div class="msg-box" id="chat-content">
						
                    </div>
                </div>
                <div class="res-box">
                    <ul class="action-ul clearfix">
                    <li style="background:#e6e7ea;">&nbsp;</li>
                        <li class="action-li">
                            <span class="emotion"><i class="ico ico-face"></i>表情</span>
                        </li>
                        <li class="action-li">
                            <span class="action"><i class="ico ico-picture"><input class="s-tp" type="file" name="file" id="uploadImage" onchange="return uploadImageClick()" style="filter: alpha(opacity = 0); opacity: 0;" accept="image/*"></i><a href="javascript:addimage()" style="color:black;text-decoration:none;">图片</a>
                            </span>
                        </li>
                        <!-- <li class="action-li">
                            <span onclick="sc()" class="action"><i class="ico ico-snap"></i>截图</span>
                        </li> -->
                        <li class="action-li">
                            <span class="action"><i class="ico ico-file"><input class="s-file" type="file" name="file" id="uploadFile" onchange="uploadFilesClick();" style="filter: alpha(opacity = 0); opacity: 0;"></i><a href="javascript:addfile()" style="color:black;text-decoration:none;">文件</a>
                            </span>
                        </li>
                        <!-- <li class="action-li">
                            <span onclick="show()" class="action"><i class="ico ico-heart"></i>满意度评价</span>
                        </li> -->
                    </ul>
                    <input type="text" id="textInput" onkeydown="return keyPressEvent(this)" class="res-input" placeholder="有问题就向我提问吧...">
                    <div class="res-btns">
                        <a onclick="RunOnUnload();" class="btn">结束对话</a>
                        <a onclick="sendMessage();" class="btn">发送</a>
                    </div>
                </div>
            </div>
            <div class="kefu-side">
                <div class="side-widget">
                    <div class="widget-title"><span>常见问题</span></div>
                    <ul class="qa-list">
                        <li class="expand" onclick="normalQuestion('Q1')">
                            <div class="qa-unit">
                                <span class="badge">Q</span>
                                <p>兑现多久到账？</p>
                                <!-- <i class="ico ico-arrow-up"></i> -->
                            </div>
                        </li>
                        <li class="expand" onclick="normalQuestion('Q2')">
                            <div class="qa-unit">
                                <span class="badge">Q</span>
                                <p>兑现手续费多少？</p>
                                <!-- <i class="ico ico-arrow-down"></i> -->
                            </div>
                        </li>
                        <li class="expand" onclick="normalQuestion('Q3')">
                            <div class="qa-unit">
                                <span class="badge">Q</span>
                                <p>返利到账周期是多少？</p>
                            </div>
                        </li>
                        <li class="expand" onclick="normalQuestion('Q4')">
                            <div class="qa-unit">
                                <span class="badge">Q</span>
                                <p>提现有什么条件？</p>
                            </div>
                        </li>
                        <li class="expand" onclick="normalQuestion('Q5')">
                            <div class="qa-unit">
                                <span class="badge">Q</span>
                                <p>如何修改已绑定的手机？</p>
                            </div>
                        </li>
                        <li class="expand" onclick="normalQuestion('Q6')">
                            <div class="qa-unit">
                                <span class="badge">Q</span>
                                <p>淘宝商品如何返利？</p>
                            </div>
                        </li>
                        <li class="expand" onclick="normalQuestion('Q7')">
                            <div class="qa-unit">
                                <span class="badge">Q</span>
                                <p>淘宝订单如何提交理赔？</p>
                            </div>
                        </li>
                        <li class="expand" onclick="normalQuestion('Q8')">
                            <div class="qa-unit">
                                <span class="badge">Q</span>
                                <p>京东、1号店等B2C商城如何提交理赔？</p>
                            </div>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!--满意度弹层-->
    <div class="dl-mask" id="gaicolour"></div>
    <div class="dl-wrap" id="dl-wrap">
        <div class="dl-title">满意度评价<div class="close" id="close"><a href="javascript:close();">×</a></div></div>
        <div class="dl-content">
            <div class="invest-unit">
                <h4 class="invest-title">1.您对此次服务的评价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span id="satisfactionRadio" style="font-size:21px; color:#F00;float:right;"></span></h4>
                <div class="invest-wrap">
                    <div class="radio-wrap">
                        <input type="radio" name="service" id="r5" value="1">
                        <label for="r5">非常满意</label>
                    </div>
                    <div class="radio-wrap">
                        <input type="radio" name="service" id="r4" value="2">
                        <label for="r4">较好</label>
                    </div>
                    <div class="radio-wrap">
                        <input type="radio" name="service" id="r3" value="3">
                        <label for="r3">一般</label>
                    </div>
                    <div class="radio-wrap">
                        <input type="radio" name="service" id="r2" value="4">
                        <label for="r2">较差</label>
                    </div>
                    <div class="radio-wrap">
                        <input type="radio" name="service" id="r1" value="5">
                        <label for="r1">恶劣</label>
                    </div>
                </div>
            </div>
            <div class="invest-unit">
                <h4 class="invest-title">2.您的问题得到解决了吗？&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span id="questionSolve" style="font-size:21px; color:#F00;float:right;"></span></h4>
                <div class="invest-wrap">
                    <div class="radio-wrap">
                        <input type="radio" name="solve" id="ryes" value="y">
                        <label for="ryes">是</label>
                    </div>
                    <div class="radio-wrap">
                        <input type="radio" name="solve" id="rno" value="n">
                        <label for="rno">否</label>
                    </div>
                </div>
            </div>
            <div class="invest-unit">
                <textarea rows="3" class="wish-input" id="suggest" maxlength="150" onkeydown="if(this.value.length &gt;= 150){ return false }" placeholder="建议(选填)"></textarea>
            </div>
        </div>
        <div class="dl-btns">
            <div class="input-tips">您还可以输入<span id="wordNum">150</span>/150字</div>
            <button class="btn-submit" onclick="tijiao()">提交</button>
        </div>
    </div>
   <div class="dl-wrapimg" id="dl-wrapimg">
        <div class="dl-title"><div class="close" id="close"><a href="javascript:close();">×</a></div></div>
     <img id="image">
    </div>



</body></html>