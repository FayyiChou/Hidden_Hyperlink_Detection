<!DOCTYPE html><html lang="en"><head><script type="text/javascript" async="" charset="utf-8" src="http://c.cnzz.com/core.php?web_id=1260114002&amp;t=q"></script>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8;">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta name="screen-orientation" content="portrait">   
    <meta name="x5-orientation" content="portrait"> 
    <title>31天PPTV会员免费送</title>
    <link href="//static9.pplive.cn/vip/wap/subject/2016/didichezhu/v_20160906154646/css/style.css" rel="stylesheet" type="text/css">
    <!--公共title-->
    <!--seajs头部引用模块对应2.0版（2014大首页始用版）-->
        <script type="text/javascript" charset="utf-8" async="" src="//w.cnzz.com/dplus.php?id=1260114002"></script><script type="text/javascript" src="//static9.pplive.cn/pptv/main/v_20141015100259/seajs/2.2.1/sea.js"></script>
        <!-- 引入封装了failback的接口-initGeetest -->
        <script src="//static.geetest.com/static/tools/gt.js"></script>
        <!--活动Dplus-->
        <!-- start Dplus --><script type="text/javascript">!function(a,b){if(!b.__SV){var c,d,e,f;window.dplus=b,b._i=[],b.init=function(a,c,d){function g(a,b){var c=b.split(".");2==c.length&&(a=a[c[0]],b=c[1]),a[b]=function(){a.push([b].concat(Array.prototype.slice.call(arguments,0)))}}var h=b;for("undefined"!=typeof d?h=b[d]=[]:d="dplus",h.people=h.people||[],h.toString=function(a){var b="dplus";return"dplus"!==d&&(b+="."+d),a||(b+=" (stub)"),b},h.people.toString=function(){return h.toString(1)+".people (stub)"},e="disable track track_links track_forms register unregister get_property identify clear set_config get_config get_distinct_id track_pageview register_once track_with_tag time_event people.set people.unset people.delete_user".split(" "),f=0;f<e.length;f++)g(h,e[f]);b._i.push([a,c,d])},b.__SV=1.1,c=a.createElement("script"),c.type="text/javascript",c.charset="utf-8",c.async=!0,c.src="//w.cnzz.com/dplus.php?id=1260114002",d=a.getElementsByTagName("script")[0],d.parentNode.insertBefore(c,d)}}(document,window.dplus||[]),dplus.init("1260114002");</script><!-- end Dplus --> 
<style>
.logo{position:absolute;top:4%;left:26%;width:50%;}
.logo img{width:100%;height: auto}
.dialog{position: fixed;top:30%;left:50%;width: 70%;margin:0;margin-left:-35%;}
@media screen and (max-width: 321px) {
    .dialog .txtScuess .p1 {font-size: 17px;padding-bottom: 2%;}
    .dialog .txtScuess .p2 {font-size: 12px;}
    .part2 .txt_scuess {font-size: 22px;}
    .part2 .nickname {font-size: 17px;line-height: 3;}
    .part2 .viptime {line-height: 1;font-size: 12px;}
    .part2 .txt_scuess {font-size: 21px;line-height: 2.6;}
    .part2 .nickname {font-size: 18px;line-height: 2.4;}
    .part2 .viptime {line-height: 1.4;font-size: 13px;}    
}
</style>
</head>
    <!-- content { -->
    <body><div class="xl_main">
        <div class="part part1">
            <img src="//static9.pplive.cn/vip/wap/subject/2016/didichezhu/v_20160906154646/css/part1.png">  
            <div class="logo"><img src="//static9.pplive.cn/vip/wap/subject/2016/didichezhu/v_20160906154646/css/logo.png"></div>  
        </div>
        <div class="part part2">
            <img src="//static9.pplive.cn/vip/wap/subject/2016/didichezhu/v_20160906154646/css/part2.png">
            <div class="boxsure">
                <img src="//static9.pplive.cn/vip/wap/subject/2016/didichezhu/v_20160906154646/css/vip.png">
                <a href="javascript:void(0)"><span class="spbtn" id="spbtn"></span></a>
            </div>
            <div class="boxarea none" style="width:100%;height:100%;position:absolute;top:0%;left:0%">
                <div class="txt_scuess" id="txt_scuess"></div>
                <div class="txt_nametime">
                    <div class="nickname" id="nickname"></div>
                    <div class="viptime" id="viptime"></div>
                </div>
                <div class="line"></div>
            </div> 
        </div>    
        <div class="part part3">
            <img src="//static9.pplive.cn/vip/wap/subject/2016/didichezhu/v_20160906154646/css/part3.png">
        </div>
        <div class="part part4">
            <img src="//static9.pplive.cn/vip/wap/subject/2016/didichezhu/v_20160906154646/css/part4.png">
            <div class="rule">
                <h1 class="title">活动规则</h1>
                <p>1、点击“立即领取”完成注册或者登录之后即可获得1个月PPTV会员，即时到账；</p>
                <p>2、领取成功后，下载PPTV聚力移动客户端，登录即可享受会员权益，若领取时使用第三方登录，则登录PPTV时仍然使用第三方登录享受权益。</p>
                <p>3、每位滴滴车主用户在活动期间仅可获赠一次；</p>
                <p>4、本活动最终解释权归PPTV聚力所有。客服热线：400-001-2007</p>
            </div>
        </div>
    </div>  

<div id="popup-captcha" class="hide"></div>
<!-- 登录/用户信息 -->
<script type="text/javascript">
/*seajs2.0 全局config模块集合*/
window._mainVersion = 'v_20160607185536/dist'; /* seajs2.0及兼容1.0公用JS版本--号-- */
seajs.importStyle=function importStyle(b){var a=document.createElement("style"),c=document;c.getElementsByTagName("head")[0].appendChild(a);if(a.styleSheet){a.styleSheet.cssText=b}else{a.appendChild(c.createTextNode(b))}};
seajs.config({
    base: 'http://static9.pplive.cn/pptv/main/'+ _mainVersion,
    alias: {
        "jquery": "http://static9.pplive.cn/pptv/main/" + _mainVersion + "/lib/jquery/1.8.3/jquery.js",
        "login": "util/login",
        "user": "util/user",
        "client" : "http://static9.pplive.cn/pc_client/v_20160115145907/clt.js",
    }
});
</script>
<!--客户端登陆js-->
<script type="text/javascript" src="http://static9.pplive.cn/oth/2012/10/jssdk/v_20150408155209/jsbridge.js"></script>
<!-- 登录/用户信息 -->
<script type="text/javascript">
	window.domain="pptv.com"; 
	window.PPName="";
	window.nickname="";
	window.Token="";
	window.viptype="";
	window.facepic="";
	var cookie = document.cookie;  
	var arrycookie = cookie.split(";");
	initH5();
	function initH5(){
		for(var i=0; i<arrycookie.length; i++){    
			try{
				var arrcookie = arrycookie[i].split("="); 
				var cookieName = arrcookie[0].replace(/(^\s*)|(\s*$)/g,"");
			}catch(err){
				var cookieName = "0";
			}
			if(cookieName=="PPName"){
				PPName = arrcookie[1].split("$")[0];
				PPName =PPName.split("%24")[0];
				PPName = decodeURIComponent(PPName);
			} else if(cookieName=="UDI"){
				viptype = arrcookie[1].split("$")[17]; 
				nickname = arrcookie[1].split("$")[16]; 
				nickname = decodeURIComponent(nickname);
				facepic = arrcookie[1].split("$")[9]; 
				facepic = "http://face.passport.pplive.com/"+facepic;
			} else if(cookieName=="ppToken"){
				Token = arrcookie[1];
			}
		}
	}
	
	function checkLoginH5(logintype){
		seajs.use(['jquery','login','user'], function($, login, user){
			if(!user.isLogined){
				var returnUrl = encodeURIComponent(window.location.href);
				if("msite" == logintype){
              //调用m站登陆页面
					window.location.href = "http://i.pptv.com/h5user/login?target=new&mobile=1&back=" + returnUrl;
				} else{
					window.location.href = "http://i.pptv.com/h5login?returnUrl=" + returnUrl + " & ";
				}
				
			} else{
				initName();
			}
		});
	}


	function setLoginH5(){
		seajs.use(['jquery','login','user'],function($,login,user){
			if(user.isLogined){
				initName();
			}
		});
	}

	function setCookie(name,value,days){
		if (days){
			var date = new Date();
			date.setTime(date.getTime()+(days*24*60*60*1000));
			var expires = "; expires="+date.toGMTString();
		}
		else var expires = "";
		document.cookie = name+"="+value+expires+"; path=/";
	}
	
	function delCookie(name) { 
		var exp = new Date(); 
		exp.setTime(exp.getTime() - 1); 
		document.cookie= name + "=;expires="+exp.toGMTString()+";path=/;domain=pptv.com";
	} 
	
	function run(){
		external.userLogin('loginCallback'); 
	} 
        
	function loginCallback(info) { 
		var data = info.constructor === String ? JSON.parse(info) : info; 
		var userinfo=data.content;
		if(data && data.message === 'ok'){
			PPName=userinfo.userName;
			Token=userinfo.token;
			nickname=userinfo.nickname;
			initName();
			viptype=userinfo.vipinfo.viptype;
			if(userinfo.vipinfo.isyearvip==1) viptype="1";
			setCookie("PPName",PPName,1);
			setCookie("PPToken",Token,1);
		} else {    
			//run();
		} 
	}
	
	function androidtakeUserData(){ 
		external.currentUserInfo('takeUserDataCallback'); 
	} 
        
	function takeUserDataCallback(info){ 
		var data = info.constructor === String ? JSON.parse(info) : info; 
		var userinfo=data.content;
		if(data && data.message === 'ok'){ 
			PPName=userinfo.userName;
			Token=userinfo.token;
			nickname=userinfo.nickname;
			initName();
			viptype=userinfo.vipinfo.viptype;
			if(userinfo.vipinfo.isyearvip==1) viptype="1";
			setCookie("PPName",PPName,1);
			setCookie("PPToken",Token,1);
		} else { 
			setCookie("PPName","",-1);
			setCookie("PPToken","",-1);
			run();
		} 
	}

	function checkLoginApp(){
		ppsdk.config({});
		ppsdk.ready(function () {
			window.login = function () {
				ppsdk.login({
					autologin: false,
					success: function (rspData) {
					PPName=rspData.userName;
					Token=rspData.token;
					nickname=rspData.nickname;
					initName();	
					viptype=userinfo.vipinfo.viptype;
					if(userinfo.vipinfo.isyearvip==1) viptype="1";
					setCookie("PPName",PPName,1);
					setCookie("PPToken",Token,1);
					},
					error: function (errCode, msg) {
						setCookie("PPName","",-1);
						setCookie("PPToken","",-1);
					},
					cancel: function () {
						setCookie("PPName","",-1);
						setCookie("PPToken","",-1);
					}
				}); 
			};
		});

		if(navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)){
			ppsdk.ready(function () {
				window.login();
			});
		}else{
			androidtakeUserData();
		}
	}
	
	//先从cookie中取，没有在从app中取，加载速度提升
	function setLoginApp(){
		if(PPName==""||Token==""){
			ppsdk.ready(function () {
				ppsdk.getUserInfo({
					success:function(rspData){
						PPName=rspData.userName;
						Token=rspData.token;
						nickname=rspData.nickname;
						initName();	
						viptype=userinfo.vipinfo.viptype;
						if(userinfo.vipinfo.isyearvip==1) viptype="1";
						setCookie("PPName",PPName,1);
						setCookie("PPToken",Token,1);
					}
				})
			});
		}else{
			initName();
		}
	}
	
	function logoutWeb(logintype){
		seajs.use('user', function(user){
			user.logout();
		});
		checkLoginH5(logintype);
	}
	
</script>    
<script>
    window.isLogin = false;
    window.type;
    window.hasjoin = false;
    var vipvalidate = "";
    function initName(){
        isLogin = true;
    }
    
    ppsdk.config({});
    //ios中ppsdk.ready比较慢，先直接加载cookie中的信息，异步获取type
    if(navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)){
        setLoginApp();
        ppsdk.ready(function () {
            ppsdk.getDeviceInfo({
                success: function(rspData) {
                    window.type = 1;
                },
                error: function(errCode, msg) {
                    window.type = 2;
                }   
            })
        })
    }else{
        ppsdk.ready(function () {
            ppsdk.getDeviceInfo({
                success: function(rspData) {
                    window.type = 1;
                    setLoginApp();
                },
                error: function(errCode, msg) {
                    window.type = 2;
                    setLoginH5();
                }   
            })
        })
    }
    function dologin(){
        if(window.type==1){
            checkLoginApp();
        }else{
            checkLoginH5();
        }
    }
</script> 
<!-- 获取用户VIP时长 -->
<script type="text/javascript"> 
    function getvipTime(){
        var vipvalidate = date = "";
        seajs.use(['jquery'],function($,user){
            $.ajax({
                url:"http://vip.pptv.com/getvipinfo/?username="+encodeURIComponent(PPName)+"&format=json&random="+Math.random(),
                dataType:'json',
                async:false,
                success:function(vipdata){
                    var validates = vipdata.validates;
                    if(!validates){
                            vipvalidate = vipdata.servertime; 
                            var date = new Date(vipvalidate);
                            date.setDate(date.getDate()+31);
                            vipvalidate = (date.getFullYear()+"-"+(parseInt(date.getMonth())+1)+"-"+date.getDate());
                            console.log(vipvalidate);
                    }else{
                        if(validates !=null && validates.length>0 && vipdata.isvalid == 1){ 
                            $.each(validates, function(t, vdata){
                                var grade = vdata["grade"];
                                if (grade == 1) {
                                    vipvalidate = vdata["validate"];
                                    vipvalidate = vipvalidate.substr(0,10);
                                }
                            });
                        }else{
                            
                        }
                    }
                }
            }); 
        }); 
        return vipvalidate;  
    }
</script> 
<!-- 31天会员添加与校验方法-->
<script type="text/javascript">
    function checkfreejoin(PPName,actid,eventid,Token,fn){
        seajs.use(['jquery','user'],function($,user){  
            var url = "http://ac.vip.pptv.com/common/checkfreejoin?username="+encodeURIComponent(PPName)+"&actid="+actid+"&eventid="+eventid+"&token="+Token+"&format=jsonp&cb=?";
            $.ajax({
                url:url,
                dataType:'json',
                async: false,
                success:function(data){
                    $code = data.errorcode; 
                    if($code != '108' && $code == "117"){
                        $(".boxsure").hide();
                        $(".boxarea").show();
                        $("#txt_scuess").html("您已领取过会员");
                        $("#nickname").html(PPName);
                        $("#viptime").html("会员有效期至："+fn());
                        return false;
                    }else{
                         $(".boxsure").show();
                         $(".boxarea").hide();
                        //console.log("用户可以参与该活动");
                    }
                }
            });
        });
    }
</script> 
<!-- //极验 -->
<style type="text/css">
.hide{display: none;}
.show{display: block;}
#popup-captcha{position: fixed;left: 0;top: 0;width: 100%;height: 100%;background-color: rgba(0,0,0,0.5);text-align: center;overflow: auto;}
#popup-captcha .popup{width:auto;}
#popup-captcha .gt_mobile_holder{margin:auto;position: relative;top:26%;}
#popup-captcha svg{} 
</style>
<div id="popup-captcha" class="hide"></div>
<script type="text/javascript">
var slinksrc = location.href;
var slink = "";
if(/https:/gi.test(slinksrc)){
    slink = "https://acvip.api.pptv.com/";
}else{
    slink = "http://ac.vip.pptv.com/";
}

var handlerPopup = function (captchaObj,cb,fn,days) {
    seajs.use(['jquery'],function($){
       $("#popup-captcha").removeClass("show").addClass("hide").html("");
       //getValidate()如果验证成功，返回验证码的结果（三个需要传给后台进行二次验证的值）对象。其他情况返回false
       var validate = captchaObj.getValidate();
       //console.log(validate);
       //console.log(PPName+"--"+actid+"--"+eventid);
       var url = slink + "common/addbygreetest?format=jsonp&cb=?";
        $.ajax({
            url: url,
            type: "post",
            dataType: "json",
            async:false,
            data: {
                username:encodeURIComponent(PPName),
                actid:actid,
                actname:actname,
                eventid:eventid,
                eventname:eventname,
                token:Token,
                geetest_challenge: validate.geetest_challenge,
                geetest_validate: validate.geetest_validate,
                geetest_seccode: validate.geetest_seccode
            },
            success: function (data) {                   
                if (data && data.errorcode == 0 && data.message === "success") {  
                   //console.log(data.message); 
                   fn(); 
                }else if(data.errorcode == 107){
                    alert("活动已下线！");
                }else{
                    alert("sorry,系统忙，请稍后再试！");
                    //console.log(data.errorcode+"--"+data.message);
                    return false; 
                }
            },
            error:function(data){
                alert("sorry,系统忙，请稍后再试！");
                //console.log('ajax请求失败！'+data.message);
                return false;
            }
        });
        window.handlerResult = cb; 
    });  
};

var funPopupdialog = function(fn,days){   
    seajs.use(['jquery'],function($){
        var Url = slink+"StartCaptcha?username="+encodeURIComponent(PPName)+"&format=jsonp&cb=?";
        $.ajax({
            url: Url,
            type: "get",
            dataType: "json",
            async:false,
            success: function (data) {
                console.log(data);
                initGeetest({
                    gt: data.gt,
                    challenge: data.challenge,
                    product: "embed", // 产品形式，包括：float，embed，popup。注意只对PC版验证码有效
                    offline: !data.success 
                }, function(obj){
                    window.o = obj;
                    console.log(o);
                    o.appendTo("#popup-captcha");
                     //验证成功时调用callback函数
                    o.onSuccess(function () {
                        handlerPopup(o, function (result) {if(result === "success"){console.log(result);}else {o.refresh();}},fn,days);
                    });
                     //验证失败时调用callback函数
                     o.onFail(function(){
                        //$("#popup-captcha").removeClass("show").addClass("hide").html("");
                     });
                    //当验证出现网络错误时调用callback函数
                    o.onError(function(){
                        $("#popup-captcha").removeClass("show").addClass("hide").html("");
                    }); 
                });
            }
        }); 
    }); 
}  
</script>  
<script type="text/javascript">
	window.actid = "didichezhu";
	window.eventid = "didichezhuloginsendvip";
	window.actname = "滴滴车主节";
	window.eventname = "滴滴车主节登录送31天vip";
	window.$code = 0;  
</script>
<!-- //具体方法 -->
<script type="text/javascript">
seajs.use(['jquery','user'],function($,user){  
    $(document).ready(function(){ 
        var showinfodiv = function(){
            $(".boxsure").hide();
            $(".boxarea").show();
            $("#nickname").html(PPName);
            $("#txt_scuess").html("您已领取过会员");
            $("#viptime").html("会员有效期至："+getvipTime());
            return false;
        }       
        if(user.isLogined || isLogin){
            checkfreejoin(showinfodiv);
        }else{
            $(".boxsure").show();
            $(".boxarea").hide();
        }
        $("#spbtn").on('click',function () {
            if(!isLogin){
                dologin();
            }else{
                console.log("islogined");
                $("#popup-captcha").removeClass("hide").addClass("show");
                funPopupdialog(showinfodiv); 
            }
        });
        $("#popup-captcha").on("click", function () {
            $("#popup-captcha").removeClass("show").addClass("hide");
        });
    });
});
</script>

</body></html>