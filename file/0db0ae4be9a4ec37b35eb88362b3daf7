<html><head></head><body><pre style="word-wrap: break-word; white-space: pre-wrap;">honey.def("lib:jquery, lib:mustache",function(e){"use strict";function t(e){var t=new RegExp("(?:^|;+|\\s+)"+e+"=([^;]*)"),i=document.cookie.match(t);return i?i[1]:""}function i(e,t,i,n,o){return t&gt;=150&amp;&amp;n.text(0),(t&gt;150||150===t)&amp;&amp;8!==o&amp;&amp;13!==o?(i.val(e.substr(0,149)),n.text(150-t),!1):void 0}function n(e){var t=new RegExp("(^|&amp;)"+e+"=([^&amp;]*)(&amp;|$)"),i=window.location.search.substr(1).match(t);return null!=i?unescape(i[2]):null}e.css("http://css.hunantv.com/standard/comment-pc.css?");var o,r="http://comment.mgtv.com",a=window.location.href.split("#")[0],d=($(window),$(document)),c=!1,s=!1,l="",h=1,m=15,f=0,u={hunantv2014:{empty:"评论内容不能为空",verify_err:"验证码不能为空",success:"&lt;i&gt;&lt;/i&gt; 评论提交成功",error:"&lt;i&gt;&lt;/i&gt; 评论提交失败，请刷新后重试",comment_max:[150,"输入字符过多，不能超过150字"],comment_min:[2,"输入字符过少，不能少于2个字"]}},p=function(){var e=~~window.location.hash.replace("#","");return e||1}(),v=function(t){c=window.USER&amp;&amp;window.USER.data,this.project=t.project,this.type=t.type,this.hasmood=t.mood||!1,this.nolist=t.nolist||!1,this.subject=t.subject_id,this.tpl=t.tpl?e.commentTpl[t.tpl]:e.commentTpl[this.project],this.rules=u[this.project],this.vote=t.vote||!1,this.box=t.element||$("#honey-comment"),this.listbox=$("div[node-type=honey-comment-list]");var i=this;this.init();var o=n("commentid");this.getList(p,o,function(){i.polling(p)}),this.bindEvents(),c&amp;&amp;(this.buildActions(),this.buildForm(),s=!0),void 0!==window.USER&amp;&amp;this.buildActions()};v.prototype.init=function(){var e=this;e.box.html(e.tpl.commentbox)},v.prototype.voteSys=function(){var n=this,r=$("div[node-type=honey-vote-box]");if(n.vote){var a=new honey.voteSys({type:n.type,subject_id:n.subject});n.voteObj=a,r.on("keydown","input[node-type=vote-text]",function(e){var t=$(this),n=~~(e.keyCode?e.keyCode:e.which),o=t.parent("div[node-type=reason]").find("b[node-type=vote-limit]"),r=t.val(),a=r.length;i(r,a,t,o,n)}),r.on("keyup","input[node-type=vote-text]",function(e){var t=$(this),i=t.val(),n=i.length,o=(e.keyCode?e.keyCode:e.which,t.parent("div[node-type=reason]").find("b[node-type=vote-limit]"));(n&gt;130||n&gt;130||130===n)&amp;&amp;t.val(i.substr(0,129)),o.text(n)}),r.on("click touchend","a[action-type=vote-btn]",function(i){i.preventDefault();$(this);if(e.loginDialog&amp;&amp;!c)return e.loginDialog(),!1;if(""==t("HDCN"))return e.loginDialog(),!1;var d=($('input:radio[name="cmt-vote"]:checked').val(),$(":radio:checked",r)),s=d.length;if(0&gt;=s)return alert("请选中投票的选项!"),!1;var l="",h=$(":radio:checked",r),m=h.val(),f=$("input[node-type=vote-text]"),u="",v=h.next().find(".item").html(),y=h.attr("value");if($.each(f,function(e){return""!==$(this).val()?(l="#投票　"+v+"#　"+$(this).val(),u=$(this).attr("id"),!1):void 0}),""==l||"支持理由（非必填）"==l)a.confirmVote(m,y);else{var g=n.hiddens.checkcode.val();o&amp;&amp;clearInterval(o),""===$.trim(g)&amp;&amp;n.hiddens.checkcode.val("-1000"),n.hiddens.content.val(l),a.confirmVote(m,y,function(){n.form.submit(),n.listenAPI(function(e){if(e.err);else{var t="-~-";n.verify_dialog&amp;&amp;n.verify_dialog.destroy(),setTimeout(function(){n.buildActions(),n.getList(p,function(){n.hiddens.content.val(""),window.location.hash=t}),$("b[node-type=vote-limit]").html(0),$("input[node-type=vote-text]").val("")},1e3)}})})}})}else r.hide()},v.prototype.polling=function(e){function t(){$.getJSON(r,a,function(e){e&amp;&amp;e.res&amp;&amp;1==e.res&amp;&amp;o.show()})}var i,n=this,o=$("div[node-type=refresh-btn]"),r="http://comment.mgtv.com/comment/poll?callback=?",a={type:n.type,subject_id:n.subject};clearInterval(i),i=setInterval(t,7e4),o.on("click","a",function(t){t.preventDefault(),n.getList(e),n.voteObj&amp;&amp;n.voteObj.init(),o.slideUp()})},v.prototype.showReportBox=function(t){var i=this,n=i.tpl.report_box,o=Mustache.render(n,{cid:t,subject_id:i.subject,type:i.type}),r=i.report_dialog=new e.dialog({id:"honey-comment-report-dialog",html:'&lt;div id="honey-comment-report-dialog"&gt;&lt;div class="honey-dialog-conBox"&gt;&lt;/div&gt;&lt;/div&gt;',content:o,height:282,width:480,opacity:.5});r.open(),r.find(".report-submit").click(function(e){e.preventDefault(),r.find("form").submit(),r.close(),$("#report-"+t).text("已举报").attr("cid",0)})},v.prototype.showVerifyBox=function(t){var i=this,n=i.tpl.verify_box,o="http://comment.mgtv.com/comment/checkcode?"+Math.random(),r=Mustache.render(n,{verify_img:o}),a=i.verify_dialog=new e.dialog({id:"honey-comment-verify-dialog",html:'&lt;div id="honey-comment-verify-dialog"&gt;&lt;div class="honey-dialog-conBox"&gt;&lt;/div&gt;&lt;/div&gt;',content:r,height:218,width:400,opacity:.5});i.verify_dialog._open=function(){a.open();var e=a.find(".verify-img");a.refresh_verify=function(){var t=e,i=t.attr("src")+"?"+Math.random();return t.attr("src",i),!1},e.click(a.refresh_verify),e.next().click(a.refresh_verify);var t=a.find(".verify-error"),n=a.find(".verify-input");i.verify_dialog.error_el=t,i.verify_dialog.input_el=n,i.verify_dialog.refresh_verify=a.refresh_verify,a.find(".verify-submit").click(function(e){e.preventDefault();var o=n.val();return""===$.trim(o)?(t.text("请输入验证码").show(),n.focus(),n.one("click",function(){t.empty().hide()}),!1):(i.hiddens.checkcode.val(o),void $(l).trigger("click"))}),a.find("input.verify-input").keyup(function(e){var t=$(this),i=e.keyCode?e.keyCode:e.which,n=a.find("."+t.attr("trigger-box"));return"13"==i?(n.trigger("click"),e.preventDefault(),!1):void 0})},i.verify_dialog._open()},v.prototype.showBanBox=function(t){var i,n=this,o=n.tpl.ban_box,t=~~t,r=Mustache.render(o,{sec:t}),a=n.ban_dialog=new e.dialog({id:"honey-comment-ban-dialog",html:'&lt;div id="honey-comment-ban-dialog"&gt;&lt;div class="honey-dialog-conBox"&gt;&lt;/div&gt;&lt;/div&gt;',content:r,height:188,width:340,opacity:.5}),d=a.find("#comment-sec-count");a.open(),i=setInterval(function(){return t--,0&gt;=t?(a.destroy(),void clearInterval(i)):void d.text(t)},1e3)},v.prototype.createForm=function(e,t){var i=this,n={},o=$("&lt;form /&gt;").attr({action:t.api,target:t.id,method:"POST"}).appendTo("body");return $.each(e,function(e,t){n[e]=$("&lt;input /&gt;").attr({type:"hidden",name:e,value:t}).appendTo(o)}),"hiddens"==t.type?i.hiddens=n:i.uphiddens=n,o},v.prototype.buildForm=function(){if(!s){var e=this;e.iframe&amp;&amp;e.iframe.remove(),e.form&amp;&amp;e.form.remove(),e.upform&amp;&amp;e.upform.remove();var t="honey-comment-iframe",i=$('&lt;iframe frameborder="0" height="0" name="'+t+'" id="'+t+'" width="0"/&gt;').appendTo("body"),n=!1,o=!1,d="";c&amp;&amp;(n=c.third_info[0],o=c.third_info[1]),window.VIDEOINFO&amp;&amp;window.VIDEOINFO.cname&amp;&amp;(d=window.VIDEOINFO.cname);var l={type:e.type,subject_id:e.subject,content:"",fid:0,mood:0,tqq_rsync:o||0,weibo_rsync:n||0,cname:d,method:"post",checkcode:"",url:a,comment_id:0},h={api:r+"/video_comment/post",id:t,type:"hiddens"};e.form=e.createForm(l,h);var m={type:e.type,subject_id:e.subject,method:"post",url:a,comment_id:0},f={api:r+"/video_comment/up",id:t,type:"uphiddens"};e.upform=e.createForm(m,f),e.iframe=i}},v.prototype.listenAPI=function(e){var t=1;self.timer=setInterval(function(){var i=window.location.href,n=i.split("#")[1],n=decodeURIComponent(n);return n&amp;&amp;n.indexOf("err")&gt;0?(clearInterval(self.timer),self.timer=null,n=$.parseJSON(n),t=1,void e(n)):(t++,void(t&gt;50&amp;&amp;(clearInterval(self.timer),self.timer=null,t=1,alert("您好，数据请求超时"))))},800)},v.prototype.bindEvents=function(){var n=this,r=n.box;n.timer=null,d.on("HONEY-LOGIN-DONE",function(){c=window.USER&amp;&amp;window.USER.data,n.buildForm(),n.buildActions(),s=!0}),d.on("HONEY-LOGIN-ERR",function(){n.buildActions()}),r.on("click","ul[node-type=honey-comment-pages] a",function(e){if(e.preventDefault(),!$(this).hasClass("ellipsis")){var t=~~$(this).attr("href").split("#")[1];t!==p&amp;&amp;(window.location.hash="-~-",n.getList(t))}}),r.on("click",".third",function(e){var t=$(this),i=t.attr("class"),o=i.match(/(wb-sina|wb-tencent)/);return o=o?"."+o[1]:"",t.hasClass("on")?(r.find(".third"+o).data("third",!0),r.find(".third"+o).removeClass("on"),t.hasClass("wb-sina")&amp;&amp;n.hiddens.weibo_rsync.val(0),t.hasClass("wb-tencent")&amp;&amp;n.hiddens.tqq_rsync.val(0),!1):r.find(".third"+o).data("third")?(r.find(".third"+o).addClass("on"),t.hasClass("wb-sina")&amp;&amp;n.hiddens.weibo_rsync.val(1),t.hasClass("wb-tencent")&amp;&amp;n.hiddens.tqq_rsync.val(1),!1):void 0}),r.on("click touchend","#nologin-textarea,a[action-type=nologin-trigger],#nologin-head",function(t){return t.preventDefault(),e.loginDialog&amp;&amp;!c?(e.loginDialog(),!1):void 0}),r.on("click touchend","a[action-type=add-reply]",function(i){if(i.preventDefault(),e.loginDialog&amp;&amp;!c)return e.loginDialog(),!1;if(""==t("HDCN"))return e.loginDialog(),!1;var o=$(this),r=o.attr("href").split("#")[1],a=n.tpl.reply,d=$("#honey-comment-item-"+r).find(".c-comment-primary"),s=$("#reply-"+r),l=~~n.hiddens.weibo_rsync.val(),h=~~n.hiddens.tqq_rsync.val();return s.data("show")?(o.css("color","#ccc"),s.data("show",!1).hide(),!1):(o.css("color","#ff8400"),s.data("show",!0),s.fadeToggle("slow","linear"),s.length||(s=$(Mustache.render(a,{user:c,id:r,sina:l,tqq:h})),s.data({id:r,show:!0}),d.append(s)),c.third_info[0]&amp;&amp;d.find(".sina").data("third",!0),c.third_info[1]&amp;&amp;d.find(".tx").data("third",!0),d.find(".origin-content").length&amp;&amp;s.data("has-origin",!0),void s.find("input").focus())}),r.on("keydown","textarea",function(e){var t=$(this),n=~~(e.keyCode?e.keyCode:e.which),o=(r.find("#"+t.attr("box")),$("b[node-type=word-limit]")),a=t.val(),d=a.length;i(a,d,t,o,n),t.parent().removeClass("warning")}),r.on("keyup","textarea",function(e){var t=$(this),i=t.val(),n=i.length,o=e.keyCode?e.keyCode:e.which,a=r.find("#"+t.attr("box")),d=a.find("b[node-type=word-limit]"),c=a.find("a.btn-postcmt");return d.text(150-n),n&gt;=150&amp;&amp;(t.val(i.substr(0,150)),d.text(0)),c[(n&gt;0?"add":"remove")+"Class"]("active"),"13"==o&amp;&amp;n&gt;0?(c.trigger("click"),e.preventDefault(),!1):void 0}),r.on("click touchend","a[action-type=reply-btn]",function(i){if(i.preventDefault(),""==t("HDCN"))return e.loginDialog(),!1;o&amp;&amp;clearInterval(o);var r=$(this),a=$("#"+r.attr("reply-box")),d=a.data("id"),s=a.find("textarea"),h=$("p[node-type=honey-reply-tip]"),m=$.trim(s.val()),f=n.hiddens.checkcode.val(),u=m.length,v="a[action-type=reply-btn]";return r.data("lock")?!1:(r.data("lock",!0),""==m?(a.showError(),s.focus(),s.one("keyup",a.hideError()),r.data("lock",!1),!1):u&gt;n.rules.comment_max[0]?(h.find("span").html(n.rules.comment_max[1]),h.find("i").hide(),h.show(),setTimeout(function(){h.hide()},1500),s.focus(),r.data("lock",!1),!1):u&lt;n.rules.comment_min[0]?(h.find("span").html(n.rules.comment_min[1]),h.find("i").hide(),h.show(),setTimeout(function(){h.hide()},1500),s.focus(),r.data("lock",!1),!1):(n.hiddens.content.val(m),n.hiddens.fid.val(d),""===$.trim(f)&amp;&amp;n.hiddens.checkcode.val("-1000"),a.data("has-origin")&amp;&amp;(p=1),n.form.submit(),void n.listenAPI(function(e){if(r.data("lock",!1),e.err)switch(~~e.code){case 1e3:l=v,n.verify_dialog?n.verify_dialog._open():n.showVerifyBox.call(n,v);break;case 1004:n.ban_dialog?n.ban_dialog.open():n.showBanBox.call(n,e.msg);break;case 1011:if(n.verify_dialog){var t=n.verify_dialog;t.error_el.text(e.msg).show(),t.input_el.val(""),t.input_el.focus(),t.refresh_verify()}break;default:alert(e.msg)}else{var i="-~-";n.verify_dialog&amp;&amp;n.verify_dialog.destroy(),a.find(".submit-success").show(),setTimeout(function(){n.buildActions(),n.getList(p,function(){n.hiddens.content.val(""),n.hiddens.fid.val(0),n.hiddens.weibo_rsync.val(c.third_info[0]),n.hiddens.tqq_rsync.val(c.third_info[1]),window.location.hash=i}),a.find(".submit-success").hide()},1e3)}n.hiddens.checkcode.val("")})))}),r.on("mouseenter",".mod-comment-main-box",function(){$(this).find("span.report-hide").attr("class","report-show")}),r.on("mouseleave",".mod-comment-main-box",function(){$(this).find("span.report-show").attr("class","report-hide")}),r.on("click","span.report",function(i){if(i.preventDefault(),e.loginDialog&amp;&amp;!c)return window.location.hash="comment--",e.loginDialog(),!1;if(""==t("HDCN"))return e.loginDialog(),!1;var o=~~$(this).attr("cid");return o?(n.report_dialog&amp;&amp;n.report_dialog.destroy(),void n.showReportBox.call(n,o)):!1}),r.on("click touchend","a[action-type=submit-trigger]",function(i){if(i.preventDefault(),""==t("HDCN"))return e.loginDialog(),!1;o&amp;&amp;clearInterval(o);var a=$("p[node-type=honey-text-tip]"),d=$(this);if(d.data("lock"))return!1;d.data("lock",!0);var s=r.find("#honey-action-box"),h=s.find("textarea"),m=s.find(".textarea-wrapper"),f=n.hiddens.checkcode.val(),u=$.trim(h.val()),p=u.length,v="a[action-type=submit-trigger]";if(""==u)return s.showError(),h.focus(),h.one("keyup",s.hideError()),d.data("lock",!1),m.addClass("warning"),!1;if(p&gt;n.rules.comment_max[0]){a.find("i").hide();var y=a.find("span").html(n.rules.comment_max[1]).show();return setTimeout(function(){y.hide()},1500),h.focus(),d.data("lock",!1),m.addClass("warning"),!1}return 2&gt;p?(a.find("span").html(n.rules.comment_min[1]),a.find("i").hide(),a.show(),setTimeout(function(){a.hide()},1500),m.addClass("warning"),d.data("lock",!1),!1):(n.hiddens.content.val(u),""===$.trim(f)&amp;&amp;n.hiddens.checkcode.val("-1000"),n.form.submit(),void n.listenAPI(function(e){if(e.err)switch(~~e.code){case 1e3:l=v,n.verify_dialog?n.verify_dialog._open():n.showVerifyBox.call(n,v);break;case 1004:n.ban_dialog?n.ban_dialog.open():n.showBanBox.call(n,e.msg);break;case 1011:if(n.verify_dialog){var t=n.verify_dialog;t.error_el.text(e.msg).show(),t.input_el.val(""),t.input_el.focus(),t.refresh_verify()}break;default:alert(e.msg)}else n.verify_dialog&amp;&amp;n.verify_dialog.destroy(),h.val(""),a.find("span").html("发布成功"),a.find("i").show(),a.show(),n.hiddens.weibo_rsync.val(c.third_info[0]),n.hiddens.tqq_rsync.val(c.third_info[1]),setTimeout(function(){n.buildActions(),n.getList(1,function(){window.location.hash="-~-",a.hide()})},1e3);n.hiddens.checkcode.val(""),d.data("lock",!1)}))}),$("a[action-type=gotocmt-btn]").on("click",function(){$("#honey-comment").find("textarea").focus()}),r.on("click touchend","a[action-type=up-comment]",function(t){if(t.preventDefault(),e.loginDialog&amp;&amp;!c)return e.loginDialog(),!1;var i=$(this),o=i.attr("href").split("#")[1];return i.data("lock")?!1:(i.data("lock",!0),n.uphiddens.comment_id.val(o),n.upform.submit(),void n.listenAPI(function(e){e.err?alert(e.msg):(n.uphiddens.comment_id.val(0),i.find("em[node-type=up-num-box]").text(e.msg),window.location.hash="position-"+o,i.addClass("on"))}))})},v.prototype.getList=function(e,t,i){var n=this,o=$("div[node-type=honey-comment-list]"),a=r+"/video_comment/list/?callback=?";"function"==typeof t&amp;&amp;(i=t,t=null),p=e,o.empty().css("opacity","0.5");var d={type:n.type,subject_id:n.subject,page:e};t&amp;&amp;(d.commentId=t,d.page=void 0),$.getJSON(a,d,function(r){if(r.err)return void o.html(r.msg).show();var a=r.comments;for(f=r.total_number,h=f-e*m,0&gt;h&amp;&amp;(h=0),a&amp;&amp;a.length?$("div[node-type=honey-no-comment]").hide():(f=0,a=[],$("div[node-type=honey-no-comment]").show()),$("span[node-type=comments-total-nums]").html(r.total_number),$(".comments-total-nums").html(r.total_number),p=r.current_page;a.length;)n.renderItem(a.pop());o.animate({opacity:1},500,function(){t&amp;&amp;$("html, body").animate({scrollTop:$("#honey-comment-item-"+t).offset().top-100},1e3)}),n.buildPages(f),i&amp;&amp;i()})},v.prototype.buildPages=function(e){var t=this,i=$("ul[node-type=honey-comment-pages]"),n=Math.ceil(e/m),o=t.tpl.pageList,r=5,a=Math.ceil(r/2),d=[],c=function(){return this==p};if(2&gt;n)return void $("a[action-type=gotocmt-btn]").hide();var s=p-(a-1)&gt;0?p-(a-1):1,l=s+r&gt;n?n+1:s+r;r&gt;l-s&amp;&amp;(s=1&gt;l-5?1:l-5);for(var h=s;l&gt;h;h++)d.push(h);var f={first:s&gt;1?1:0,prev:1&gt;p-1?1:p-1,prev_show:1&gt;p-1?0:1,next_show:p+1&gt;n?0:1,pages:d,current:c,next:p+1&gt;n?n:p+1,end:n&gt;l?n:0,more_next:n-l&gt;0,more_prev:s-1&gt;1},u=Mustache.render(o,f);i.html(u)},v.prototype.buildActions=function(){var e=this,t=e.tpl.actions,i=e.tpl.noLogin,n=$("div[node-type=honey-comment-text]"),o={login:!1,verified:!0};if(c){o.verified=~~c.group&gt;0,c.verified=o.verified,o.login=!0,o.user=c,o.sina=c.third_info[0],o.tqq=c.third_info[1],o.name=c.nickname;var r=Mustache.render(t,o)}else var r=Mustache.render(i);n.html(r)},v.prototype.renderItem=function(e){var t=this,i={},n=$("div[node-type=honey-comment-list]");$.isArray(e)?(i.comment=e.pop(),i.comments=e,$.each(i.comments,function(e,t){t.no=e+1})):i=e,i.show_verify="芒果小秘书"===i.user.nickname?"":"display:none;",i.no=++h,i.ie=honey.ie&amp;&amp;honey.ie&lt;7;var o=Mustache.render(t.tpl.list,i);n.prepend(o)},$.fn.showError=function(){$(this).removeClass("sel").addClass("sel-1")},$.fn.hideError=function(){var e=$(this);return function(){e.removeClass("sel-1").addClass("sel")}},e.comment=v});</pre></body></html>