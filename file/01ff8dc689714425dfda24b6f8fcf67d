<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta name="Keywords" content="砂与海之歌,第24章 图穷匕现（上）">
    <meta name="Description" content="酷漫网为您提供砂与海之歌漫画，第24章 图穷匕现（上）在线阅读，看砂与海之歌最新章节、更多章节请收藏酷漫网。">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="gray">
    <meta name="full-screen" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=2.0,user-scalable=yes, shrink-to-fit=no minimal-ui">
    <title>砂与海之歌漫画 - 第24章 图穷匕现（上）在线阅读 - 酷漫网 - 酷漫网</title>
    <link type="text/css" rel="stylesheet" href="http://m.kuman.com/static/css/global.css">
    <link type="text/css" rel="stylesheet" href="http://m.kuman.com/static/css/read.css?v=2">
    <script src="http://push.zhanzhang.baidu.com/push.js"></script><script src="//hm.baidu.com/hm.js?3862718383598b6b32a519e9d61475b5"></script><script>
        var cp = {
            url:{"ext":"\/","dot":"-","request":"","full_request":"http:\/\/m.kuman.com"},
            link: function (controller, action, params) {
                var c = typeof controller === 'undefined' ? this.url['full_request'] : this.url['request'] + '/', a = action || 'index', p = params || [];
                return c + (a == 'index' ? [controller] : [controller, a]).concat(p).join(this.url['dot']) + this.url['ext'];
            },
            main_url: 'http://www.kuman.com'
        }
    </script>
</head>
<body>

    <header class="index-header" id="index-header" style="display: none; ">
        <a class="logo fl" href="/"><img src="http://m.kuman.com/static/images/logo.png"></a>
        <div class="home fr">
                            <a class="avatar" href="http://passport.kuman.com/account/login?app_id=km_wap&amp;sign=da43b4439808eb01b8175e8768f531aa&amp;t=1491061883&amp;back_uri=http%253A%252F%252Fm.kuman.com%252Fmh-1001044%252F25%252F"><img src="http://m.kuman.com/static/images/avatar.png"></a>
                    </div>
    </header>

<div class="wrapper">
    <header class="header header-read" id="header" style="height: 48px; display: none; ">
        <a href="javascript:window.history.back();" class="iBtn back"><span id="pageNum">1</span>/20</a>
        <h1 class="title">第25话</h1>
        <a href="javascript:void(0);" class="iBtn"></a>
        <a href="javascript:void(0);" class="iBtn unknown"></a>
    </header>

    <div class="read-wp">
        <div class="cont-wp">
            <ul id="imgLi">
                <li><img src="http://s1.static.kuman.com/342e269019d4f95518f2a1a32d0fe50c" data-image_id="1350"></li><li><img src="http://s1.static.kuman.com/dcceb830fab7c3f186fcc22d3da94b30" data-src="http://s1.static.kuman.com/dcceb830fab7c3f186fcc22d3da94b30" data-image_id="1351"></li><li><img src="http://s1.static.kuman.com/eeeab24d475a97830ebbd347b3a34ecb" data-src="http://s1.static.kuman.com/eeeab24d475a97830ebbd347b3a34ecb" data-image_id="1352"></li><li><img src="http://s1.static.kuman.com/73e7384fd82fd3cfbbddb5444eabe782" data-src="http://s1.static.kuman.com/73e7384fd82fd3cfbbddb5444eabe782" data-image_id="1353"></li><li><img src="http://s1.static.kuman.com/8c8565e647e2e4c32796e0a302d26d02" data-src="http://s1.static.kuman.com/8c8565e647e2e4c32796e0a302d26d02" data-image_id="1354"></li><li><img src="http://s1.static.kuman.com/bc081558d0feb208b34e6736c5c84756" data-src="http://s1.static.kuman.com/bc081558d0feb208b34e6736c5c84756" data-image_id="1355"></li><li><img src="http://s1.static.kuman.com/93c811088272c3184bc8074beb6efcaf" data-src="http://s1.static.kuman.com/93c811088272c3184bc8074beb6efcaf" data-image_id="1356"></li><li><img src="http://s1.static.kuman.com/e2fa3fb50ff2d129721cd3c8d8df67b9" data-src="http://s1.static.kuman.com/e2fa3fb50ff2d129721cd3c8d8df67b9" data-image_id="1357"></li><li><img src="http://s1.static.kuman.com/c905d9c1c189fdc5b8768be75735237d" data-src="http://s1.static.kuman.com/c905d9c1c189fdc5b8768be75735237d" data-image_id="1358"></li><li><img src="http://s1.static.kuman.com/6b6ec1feefc56c05c872eff138fba612" data-src="http://s1.static.kuman.com/6b6ec1feefc56c05c872eff138fba612" data-image_id="1359"></li><li><img src="http://s1.static.kuman.com/dd090983e03358457f938dfe605afb13" data-src="http://s1.static.kuman.com/dd090983e03358457f938dfe605afb13" data-image_id="1360"></li><li><img src="http://s1.static.kuman.com/a2c7617e9e0e16a6aec9c5febfb917a7" data-src="http://s1.static.kuman.com/a2c7617e9e0e16a6aec9c5febfb917a7" data-image_id="1361"></li><li><img src="http://s1.static.kuman.com/f9a9fe931dcaaa592c851629e8869961" data-src="http://s1.static.kuman.com/f9a9fe931dcaaa592c851629e8869961" data-image_id="1362"></li><li><img src="http://s1.static.kuman.com/75a9db75e9583d2854045f94349337c2" data-src="http://s1.static.kuman.com/75a9db75e9583d2854045f94349337c2" data-image_id="1363"></li><li><img src="http://s1.static.kuman.com/0cf2b86d316635b286dbdf3b809f4fd5" data-src="http://s1.static.kuman.com/0cf2b86d316635b286dbdf3b809f4fd5" data-image_id="1364"></li><li><img src="http://s1.static.kuman.com/f04c6c43f15263594956b75eddcf0ed8" data-src="http://s1.static.kuman.com/f04c6c43f15263594956b75eddcf0ed8" data-image_id="1365"></li><li><img src="http://s1.static.kuman.com/0db621fa4d1c8bf9132f077305ff0584" data-src="http://s1.static.kuman.com/0db621fa4d1c8bf9132f077305ff0584" data-image_id="1366"></li><li><img src="http://s1.static.kuman.com/1923381613d5a67efdd97aea383d7dc7" data-src="http://s1.static.kuman.com/1923381613d5a67efdd97aea383d7dc7" data-image_id="1367"></li><li><img src="http://s1.static.kuman.com/8cafa2b83c07e5b688064364c302c892" data-src="http://s1.static.kuman.com/8cafa2b83c07e5b688064364c302c892" data-image_id="1368"></li><li><img src="http://s1.static.kuman.com/a5c1775b1856428d949baa095fd19cfc" data-src="http://s1.static.kuman.com/a5c1775b1856428d949baa095fd19cfc" data-image_id="1369"></li>            </ul>
        </div>
    </div>

    <div class="chapter-wp">
        <h2><span>砂与海之歌</span><em id="closeChapter">x</em></h2>
        <ul>
                            <li><a href="http://m.kuman.com/mh-1001044/1/" title="序章 转生之书">[1] 序章 转生之书</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/2/" title="第1章 初见底比斯">[2] 第1章 初见底比斯</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/3/" title="第2章 法老之子（上）">[3] 第2章 法老之子（上）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/4/" title="第3章 法老之子（下）">[4] 第3章 法老之子（下）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/5/" title="第4章 尼罗河祭奠（上）">[5] 第4章 尼罗河祭奠（上）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/6/" title="第5章 尼罗河祭奠（下）">[6] 第5章 尼罗河祭奠（下）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/7/" title="第6章 回到未来">[7] 第6章 回到未来</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/8/" title="第7章 艾氏兄妹">[8] 第7章 艾氏兄妹</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/9/" title="第8章 历史偏移">[9] 第8章 历史偏移</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/10/" title="第9章 吉萨之乱（上）">[10] 第9章 吉萨之乱（上）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/11/" title="第10章 吉萨之乱（下）">[11] 第10章 吉萨之乱（下）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/12/" title="第11章 穆莱之战（上）">[12] 第11章 穆莱之战（上）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/13/" title="第12章 穆莱之战（下）">[13] 第12章 穆莱之战（下）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/14/" title="第13章 莲花纹章（上）">[14] 第13章 莲花纹章（上）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/15/" title="第14章 莲花纹章（中）">[15] 第14章 莲花纹章（中）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/16/" title="第15章 莲花纹章（下）">[16] 第15章 莲花纹章（下）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/17/" title="第16章 金幼狮像（上）">[17] 第16章 金幼狮像（上）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/18/" title="第17章 金幼狮像（中）">[18] 第17章 金幼狮像（中）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/19/" title="第18章 金幼狮像（下）">[19] 第18章 金幼狮像（下）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/20/" title="第19章 神前的谎言（上）">[20] 第19章 神前的谎言（上）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/21/" title="第20章 神前的谎言（中）">[21] 第20章 神前的谎言（中）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/22/" title="第21章 神前的谎言（下）">[22] 第21章 神前的谎言（下）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/23/" title="第22章 危机暗涌（上）">[23] 第22章 危机暗涌（上）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/24/" title="第23章 危机暗涌（下）">[24] 第23章 危机暗涌（下）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/25/" title="第24章 图穷匕现（上）">[25] 第24章 图穷匕现（上）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/26/" title="第25章 图穷匕现（下）">[26] 第25章 图穷匕现（下）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/27/" title="26话 信仰（上）">[27] 26话 信仰（上）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/28/" title="27话 信仰（下）">[28] 27话 信仰（下）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/29/" title="28话  崩塌的一角">[29] 28话  崩塌的一角</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/30/" title="29话 背叛者（上）">[30] 29话 背叛者（上）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/31/" title="30话 背叛者（下）">[31] 30话 背叛者（下）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/32/" title="31话 后知后觉（上）">[32] 31话 后知后觉（上）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/33/" title="32话 后知后觉（下）">[33] 32话 后知后觉（下）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/34/" title="33话 出征之前（上）">[34] 33话 出征之前（上）</a></li>
                            <li><a href="http://m.kuman.com/mh-1001044/35/" title="34话 出征之前（下）">[35] 34话 出征之前（下）</a></li>
                    </ul>
        <p>共<span>35</span>话</p>
    </div>

    <div class="bb-plus-wp plus-wp">
        <div class="plus-con-wp bb-opt-wp">
            <div class="con-btn">
                <a id="bb-show" href="javascript:void(0);">隐藏</a>
                <a id="bb-send" href="javascript:void(0);">发弹</a>
            </div>
        </div>

        <div class="plus-btn-wp bb-opt-btn-wp">
            <a id="bb-opt-btn" href="javascript:void(0);">弹</a>
        </div>
    </div>

    <div class="plus-wp" style="display: none; ">
        <div class="plus-con-wp plus-opt-wp">
            <div class="con-btn">
                <a href="http://m.kuman.com/mh-1001044/">详情</a>
                <a href="http://m.kuman.com/">首页</a>
                <a href="http://m.kuman.com/all/">分类</a>
                <a href="http://m.kuman.com/search/">搜索</a>
            </div>
        </div>

        <div class="plus-btn-wp">
            <a id="plus-btn" href="javascript:void(0);">+</a>
        </div>
    </div>

    <footer class="foot-wp" id="footer" style="display: none; ">
        <nav class="nav">
            <a id="comicSubscribe" data-comic_id="1001044" href="javascript:void(0);">
                <dl>
                    <dt><img src="http://m.kuman.com/static/images/read-nav_r1_c1.png"></dt>
                    <dd>收藏</dd>
                </dl>
            </a>
            <a href="http://m.kuman.com/mh-1001044/24/">
                <dl>
                    <dt><img src="http://m.kuman.com/static/images/read-nav_r1_c3.png"></dt>
                    <dd>上话</dd>
                </dl>
            </a>
            <a href="http://m.kuman.com/mh-1001044/26/">
                <dl>
                    <dt><img src="http://m.kuman.com/static/images/read-nav_r2_c5.png"></dt>
                    <dd>下话</dd>
                </dl>
            </a>
            <a id="chapter-btn" href="javascript:void(0);">
                <dl>
                    <dt><img src="http://m.kuman.com/static/images/read-nav_r2_c7.png"></dt>
                    <dd>章节</dd>
                </dl>
            </a>
        </nav>
    </footer>

    <div class="bb-send-wp">
        <header class="header">
            <a href="javascript:window.history.back();" class="iBtn back"></a>
            <h1 class="title">弹幕</h1>
            <a href="javascript:void(0);" class="iBtn"></a>
        </header>
        <div class="cont-wp">
            <textarea name="bb-content" placeholder="说点什么呗！"></textarea>
        </div>
        <div class="bb-btn-wp">
            <a id="bb-btn" class="btn btn-blue" href="javascript:void(0);">发送弹幕</a>
        </div>
    </div>

    <div class="bb-wp"></div>
</div>
<script src="http://m.kuman.com/static/js/jquery-2.1.4.min.js"></script>
<script src="http://m.kuman.com/static/js/app-km.js"></script>
<script>

    var comic = {
        comic_id: 1001044,
        chapter_id: 2910,
        image_id: 1350,
        chapterPrev: 'http://m.kuman.com/mh-1001044/24/',
        chapterNext: 'http://m.kuman.com/mh-1001044/26/',
        menuData:{
            top: 48,
            bottom: km.viewH - 88,
            left: parseInt(window.innerWidth / 3),
            right: parseInt(window.innerWidth / 3) * 2
        },
        oPageNum: $('#pageNum'),
        scrollTop: 0,
        canHide: true,
        atTop: true,
        init: function() {

            $('.read-wp, .bb-wp').on('click', comic.menuChapter);
            $('#bb-opt-btn').on('click', function() {
                comic.tapPlus('.bb-opt-wp');
            });
            $('#plus-btn').on('click', function() {
                comic.tapPlus('.plus-opt-wp');
            });
            $('#chapter-btn, #closeChapter').on('touchstart', comic.chapter);
            $('.unknown').on('click', comic.unknown);
            var chapter = $('.chapter-wp');
            chapter.find('p span').html(chapter.find('ul li').length);
            setTimeout(function() {
                comic.menu.hide();
            }, 1000);
        },
        menuChapter: function(ev) {
            var x = ev.clientX, y = ev.clientY;
            if (x > comic.menuData.left && x < comic.menuData.right && y > comic.menuData.top && y < comic.menuData.bottom) {
                comic.tap(ev);
                $('.demo').html(x + '--' + y);
            } else if (x < comic.menuData.left) {
                if (comic.chapterPrev == 'javascript:void(0);') {
                    km.msg.show('没有上一章了');
                } else {
                    window.location.href = comic.chapterPrev;
                }
            } else {
                window.location.href = comic.chapterNext;
            }
        },
        delayLoad: function() {
            $('#imgLi').find('li img').each(function(i, ele) {
                if (i > 0) {
                    var _this = $(ele);
                    _this.attr('src', _this.attr('data-src'));
                }
            });
        },
        pageNumChange: function () {
            $('#imgLi').find('li').each(function(i, ele) {
                var _this = $(ele);
                var rect = _this.get(0).getBoundingClientRect();
                if (rect.top <= window.innerHeight/2 && rect.top > 0) {
                    comic.image_id = _this.find('img').attr('data-image_id');
                    comic.oPageNum.html(i+1);
                }

                if (i == 0 && rect.top > -window.innerHeight/2) {
                    comic.image_id = _this.find('img').attr('data-image_id');
                    comic.oPageNum.html(1);
                }
            });
        },
        tap: function(ev) {
            ev.preventDefault();
            var plus = $('.plus-btn-wp');
            if (plus.is(':hidden')) {
                comic.menu.show();
            } else {
                comic.menu.hide();
            }
        },
        menu: {
            show: function() {
                var header_index = $('#index-header');
                var header = $('#header');

                    header_index.css('margin-top', '0');
                    header.css('margin-top', '48px');

                header_index.slideDown('fast');
                header.slideDown('fast');
                $('#footer').slideDown('fast');
                $('.plus-wp').fadeIn('fast');
            },
            hide: function() {
                $('#index-header').slideUp('fast');
                $('#header').slideUp('fast');
                $('#footer').slideUp('fast');
                $('.plus-wp').fadeOut('fast');
                $('.bb-plus-wp').addClass('plus-wp');
            }
        },
        tapPlus: function(handle) {
            var plusCon = $(handle);
            if (plusCon.is(':hidden')) {
                this.innerHTML = '-';
                plusCon.animate({width : "show", paddingLeft : "show", paddingRight : "show"}, 500);
            } else {
                this.innerHTML = '+';
                plusCon.animate({width : "hide", paddingLeft : "hide", paddingRight : "hide"}, 500);
            }
        },
        chapter: function() {
            var chapter = $('.chapter-wp');
            if (chapter.is(':hidden')) {
                comic.scrollTop = document.body.scrollTop;
                $('html').toggleClass('alpha');
                chapter.height(window.innerHeight - 78).show();
                chapter.find('ul').height(window.innerHeight - 152);
                km.layer.show();
            } else {
                $('html').toggleClass('alpha');
                chapter.hide();
                km.layer.hide();
                window.scrollTo(0, comic.scrollTop);
            }
        },
        unknown: function() {
            var explain = $('.explain');
            if (explain.length == 0) {
                $('body').append('<div class="explain explain-op">'+
                    '<div class="item prev">上一章</div>'+
                    '<div class="item menu">菜单区</div>'+
                    '<div class="item next">下一章</div>'+
                    '</div>');
                $('.explain-op').on('click', function() {
                    $('.explain-op').hide();
                });
            } else {
                explain.show();
            }
        }
    };

    var bb = {
        bbH: 50,
        duration: 10000,
        docW: window.innerWidth,
        index: 0,
        i: 0,
        pointer: 0,
        length: 0,
        viewLen: 10,
        obb: $('.bb-wp'),
        list: [],
        p: 1,
        isDisplay: true,
        avatar: '',
        init: function() {
            bb.rend();
            $('#bb-show').on('click', bb.display);
            $('#bb-send').on('click', bb.send);
            $('#bb-btn').on('click', bb.sub.send);
            window.addEventListener('hashchange', bb.hashChange, false);
        },
        rend: function() {
            var url = cp.link('bb', 'mGetBb', [comic.comic_id, comic.chapter_id, 0, bb.p]);
            var bbHtml = '';
            $.get(url, {}, function(d) {
                if (d.status == 2) return false;
                bb.length = d.message.length;
                bb.pointer = bb.length;
                $.merge(bb.list, d.message);
                $.each(d.message, function(i, b) {
                    bbHtml += bb.build(b);
                });
                bb.obb.append(bbHtml);
                bb.position.init();
                bb.view();
                bb.p++;
                bb.more();
            });
        },
        build: function(b) {
            if(/^http.*/.test(b.avatar)){
                return '<p><img src="' + b.avatar + '" /><span>' + b.content + '</span></p>';
            }else {
                return '<p><img src="' + cp.main_url + '/static/avatar/' + b.avatar + '" /><span>' + b.content + '</span></p>';
            }
        },
        position: {
            init: function() {
                $('.bb-wp').find('p').each(function(i, ele) {
                    bb.position.set($(ele));
                });
            },
            set: function(b) {
                b.css({
                    "left": bb.docW,
                    "top": bb.bbH
                });
                bb.bbH += 36;
            }
        },
        view: function() {
            var timer1 = setInterval(function(){
                $('.bb-wp').find('p').each(function(i, ele) {
                    if (i == bb.index) {
                        var _this = $(ele);
                        var bbW = ele.clientWidth; //_this.innerWidth();
                        _this.css({
                            "-webkit-transition-duration": bb.duration + "ms",
                            "-webkit-transform": "translate(-"+ (bb.docW + bbW) +"px, 0px) translateZ(0px)"
                        });
                    }
                });

                setInterval(function(){
                    var _bb = $('.bb-wp p').eq(bb.i);
                    _bb.css({
                        "-webkit-transition-duration": "0ms",
                        "-webkit-transform": "translate(0px, 0px) translateZ(0px)"
                    });

                    bb.loop(_bb);
                    var _bbW = _bb.innerWidth();

                    setTimeout(function(){
                        _bb.css({
                            "-webkit-transition-duration": bb.duration + "ms",
                            "-webkit-transform": "translate(-"+ (bb.docW + _bbW) +"px, 0px) translateZ(0px)"
                        });
                    }, 1000);
                    bb.i++;
                    if (bb.i == bb.viewLen) {
                        bb.i = 0;
                    }
                }, bb.duration + 1000);

                bb.index++;
                if (bb.index == bb.viewLen) {
                    bb.index = 0;
                    clearInterval(timer1);
                }
            }, 1000);
        },
        more: function() {
            if (bb.length < bb.viewLen) return false;
            var loading = false;
            var timer = setInterval(function() {

                if (loading) return false;
                loading = true;
                var url = cp.link('bb', 'mGetBb', [comic.comic_id, comic.chapter_id, 0, bb.p]);
                $.get(url, {}, function(d) {
                    if (d.status == 2) {
                        clearInterval(timer); return false;
                    }
                    $.merge(bb.list, d.message);
                    bb.length = bb.list.length;
                    bb.p++;
                    loading = false;
                });
            }, 2000);
        },
        loop: function(b) {
            if (bb.length <= bb.viewLen) return false;
            var cbb = bb.list[bb.pointer];
            if (cbb == undefined) return false;
            b.find('img').attr(cbb.avatar);
            b.find('span').html(cbb.content);
            bb.pointer++;
            if (bb.pointer >= bb.length) {
                bb.pointer = 0;
            }
        },
        display: function() {
            var _this = $(this);
            if (bb.isDisplay == true) {
                bb.hide();
                _this.html('显示');
                bb.isDisplay = false;
            } else {
                bb.show();
                _this.html('隐藏');
                bb.isDisplay = true;
            }
        },
        show: function() {
            bb.obb.css({"z-index": 0});
        },
        hide: function() {
            bb.obb.css({"z-index": -1});
        },
        send: function() {
            $('.bb-send-wp').animate({width : "show"}, 200);
            window.location.hash = 'send';
            $('meta[name=viewport]').get(0).content = "width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=yes,shrink-to-fit=no minimal-ui";
        },
        sub: {
            sending: false,
            send: function() {
                if (bb.sub.sending) return false;

                var oCont = $('textarea[name=bb-content]');
                var cont = oCont.val();
                if (cont.length == 0) {
                    km.msg.show('弹幕内容不能为空'); return false;
                }
                var data = {
                    comic_id: comic.comic_id,
                    chapter_id: comic.chapter_id,
                    image_id: comic.image_id,
                    content: cont
                };
                bb.sub.sending = true;
                km.msg.show('弹幕发射中，请稍后！', -1);
                $.post(cp.link('bb', 'mSend'), data, function(d) {

                    bb.sub.sending = false;
                    if (d.status == 1) {
                        data.avatar = bb.avatar;
                        $.merge(bb.list, [data]);
                        bb.length = bb.list.length;
                        oCont.val('');
                        if (bb.length <= bb.viewLen) {
                            bb.obb.append(bb.build(data));
                            var cbb = $('.bb-wp p').eq(bb.length - 1);
                            bb.position.set(cbb);
                        }
                        if (bb.length == 1) {
                            bb.view();
                        }
                        km.msg.show(d.message, 1500, function() {
                            window.history.back();
                        });
                        return false;
                    }

                    if (d.status == 2) {
                        km.msg.show(d.message, 2000, function() {
                            window.location.href = cp.link('user', 'login');
                        });
                        return false;
                    }

                    km.msg.show(d.message);

                }, 'json');
            }
        },
        hashChange: function() {
            var hash = location.hash;
            if(hash == '') {
                $('.bb-send-wp').fadeOut();
                $('meta[name=viewport]').get(0).content = "width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=2.0,user-scalable=yes,shrink-to-fit=no minimal-ui";
            }
        }
    };

    //订阅
    var sub = {
        init: function() {
            $('#comicSubscribe').on('click', sub.send);
        },
        send: function() {
            var _this = $(this);
            var comic_id = _this.attr('data-comic_id');
            $.post(cp.link('subscribe', 'addSub'), {comic_id: comic_id}, function(d) {
                km.msg.show(d.message);
            }, 'json');
        }
    };

    $(function() {
        comic.init();

        window.addEventListener('scroll', function() {

            //可以用window.pageYOffset 或者 window.scrollY代替
            if ( (document.body.scrollTop + document.documentElement.scrollTop) == 0 ) {
                comic.atTop = true;
                comic.menu.show();
                comic.canHide = true;
            } else {
                comic.atTop = false;
            }

            if ( window.pageYOffset > 0 && window.pageYOffset < 500 && comic.canHide) {
                comic.menu.hide();
                comic.canHide = false;
            }

            if ( (document.body.scrollTop + document.documentElement.scrollTop + window.innerHeight) == document.body.scrollHeight ) {
                comic.menu.show();
            }

            comic.pageNumChange();

            //$('.demo').html((document.body.scrollTop + document.documentElement.scrollTop + window.innerHeight) + ': ' + document.body.scrollHeight);

        });

        bb.init();
        sub.init();
    });

    window.onload = function () {
        comic.delayLoad();
    }
</script>            <script>
                var _hmt = _hmt || [];
                (function () {
                    var hm = document.createElement("script");
                    hm.src = "//hm.baidu.com/hm.js?3862718383598b6b32a519e9d61475b5";
                    var s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(hm, s);
                })();
            </script>
            
<script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

</body></html>